namespace = cr_carlist_events

cr_carlist_events.98 = { #France ideology selector for testing purposes
	type = country_event

	title = cr_carlist_events.98.t
	desc = cr_carlist_events.98.desc
	flavor = cr_carlist_events.98.flavour
	
	immediate = {
	}
	option = {
		name = cr_carlist_events.1.orleanist
		custom_tooltip = cr_carlist_events.1.a_tt
		default_option = yes
		ruler = {
			set_ideology = ideology:ideology_orleanist
		}
	}
	option = {
		name = cr_carlist_events.1.legitimist
		custom_tooltip = cr_carlist_events.1.a_tt
		ruler = {
			set_ideology = ideology:ideology_legitimist
		}
	}
	option = {
		name = cr_carlist_events.1.bonapartist
		custom_tooltip = cr_carlist_events.1.a_tt
		ruler = {
			set_ideology = ideology:ideology_bonapartist
		}
	}
	option = {
		name = cr_carlist_events.1.republic
		custom_tooltip = cr_carlist_events.1.a_tt
		activate_law = law_type:law_presidential_republic
	}
}

cr_carlist_events.1 = { #The Desamortización of the Monastaries
	type = country_event
	placement = ROOT

	title = cr_carlist_events.1.t
	desc = cr_carlist_events.1.desc
	flavor = cr_carlist_events.1.flavour

	event_image = {
		video = "rp1_social_banditry"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	#on_opened_soundeffect = "event:/SFX/Events/unspecific/trains"

	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	duration = 3

	trigger = {
		NOT = {
			has_variable = cr_the_desamortizacions_have_happened
		}
		is_at_war = yes
	}

	immediate = {
		set_variable = cr_the_desamortizacions_have_happened
		c:SPA = {
			save_scope_as = cr_christinos
			ig:ig_intelligentsia = {
				save_scope_as = cr_spanish_liberals
			}
			ig:ig_devout = {
				save_scope_as = cr_spanish_catholic_church
			}
			ig:ig_landowners = {
				save_scope_as = cr_spanish_landowners
			}
			
			ig:ig_rural_folk = {
				save_scope_as = cr_carlist_war_ig_rural_folk
			}
			
			ig:ig_petty_bourgeoisie = {
				save_scope_as = cr_carlist_war_ig_petty_bourgeoisie
			}
		}
		c:CSP = {
			save_scope_as = cr_carlists
		}
		cu:basque = {
			save_scope_as = cr_basque_culture
		}
	}

	option = {
		name = cr_carlist_events.1.a
		custom_tooltip = cr_carlist_events.1.a_tt
		default_option = yes
		if = {
			limit = {
				has_technology_researched = mutual_funds
			}
			activate_law = law_type:law_commercialized_agriculture
		}
		custom_tooltip = {
			text = cr_carlist_events.1.a_tt2
			set_variable = cr_desamortizacions_upper
		}
		add_loyalists = {
			pop_type = aristocrats
			value = large_radicals
		}
		add_loyalists = {
			pop_type = capitalists
			value = large_radicals
		}
		add_modifier = {
			name = cr_desamortizacion_auctioned
			months = 37
		}
		scope:cr_spanish_liberals = { 
			add_modifier = {
				name = cr_desamortizacion_ig_liberals
				months = 61
				is_decaying = yes
			}		
		}
		scope:cr_spanish_catholic_church = { 
			add_modifier = {
				name = cr_desamortizacion_ig_devout
				months = 122
				is_decaying = yes
			}		
		}
		ai_chance = {
			base = 80
		}
	}

	option = {
		name = cr_carlist_events.1.b
		custom_tooltip = cr_carlist_events.1.b_tt
		activate_law = law_type:law_homesteading
		custom_tooltip = {
			text = cr_carlist_events.1.b_tt2
			set_variable = cr_desamortizacions_lower
		}
		add_loyalists = {
			pop_type = farmers
			value = medium_radicals
		}
		add_loyalists = {
			pop_type = peasants
			value = medium_radicals
		}
		scope:cr_spanish_liberals = { 
			add_modifier = {
				name = cr_desamortizacion_ig_liberals
				months = 61
				is_decaying = yes
			}		
		}
		scope:cr_spanish_catholic_church = { 
			add_modifier = {
				name = cr_desamortizacion_ig_devout
				months = 122
				is_decaying = yes
			}		
		}		
		ai_chance = {
			base = 9
		}
	}

	option = {
		name = cr_carlist_events.1.c
		custom_tooltip = cr_carlist_events.1.c_tt
		custom_tooltip = {
			text = cr_carlist_events.1.c_tt2
			set_variable = cr_desamortizacions_halted
		}
		activate_law = law_type:law_tenant_farmers
		add_loyalists = {
			pop_type = clergymen
			value = very_large_radicals
		}
		scope:cr_spanish_liberals = { 
			add_modifier = {
				name = cr_desamortizacion_denied_ig_liberals
				months = 61
				is_decaying = yes
			}		
		}
		scope:cr_spanish_catholic_church = { 
			add_modifier = {
				name = cr_desamortizacion_denied_ig_devout
				months = 122
			}		
		}
		
		ai_chance = {
			base = 1
		}
	}
}

cr_carlist_events.10 = { #The Embrace of Vergara (Christino Victory)
	type = country_event
	placement = p:xABE0B3

	title = cr_carlist_events.10.t
	desc = cr_carlist_events.10.desc
	flavor = cr_carlist_events.10.flavour

	event_image = {
		video = "unspecific_military_parade"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	#on_opened_soundeffect = "event:/SFX/Events/unspecific/trains"

	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	duration = 3

	trigger = {
	}

	immediate = {
		s:STATE_NAVARRA.region_state:SPA = { save_scope_as = cr_state_navarra }
		random_political_movement = {
			limit = {
				is_political_movement_type = movement_carlists
			}
			save_scope_as = carlist_movement
		}
		random_political_movement = {
			limit = {
				is_political_movement_type = movement_christinos
			}
			save_scope_as = christinos_movement
		}
        remove_variable = cr_carlist_war_ongoing
		
		#Setting up the fueros
		establish_the_basque_fueros_effect = yes
		c:NAV = {
			save_scope_as = cr_kingdom_of_navarra
		}
		establish_the_catalan_fueros_effect = yes
		c:CAT = {
			save_scope_as = cr_kingdom_of_aragon
		}
		s:STATE_NAVARRA.region_state:NAV = {
			save_scope_as = cr_state_navarra
		}
		
		c:SPA = {
			save_scope_as = cr_christinos
			ig:ig_intelligentsia = {
				save_scope_as = cr_spanish_liberals
			}
			ig:ig_devout = {
				save_scope_as = cr_spanish_catholic_church
			}
			ig:ig_landowners = {
				save_scope_as = cr_spanish_landowners
			}
			
			ig:ig_rural_folk = {
			}
			
			ig:ig_petty_bourgeoisie = {
			}
			save_scope_as = spain
		}
		cu:basque = {
			save_scope_as = cr_basque_culture
		}
		cu:catalan = {
			save_scope_as = cr_catalan_culture
		}
		don_carlos_exile_country_selector = yes
		random_character_in_void = {
			limit = {
				has_template = ecchi_spa_infante_carlos_character_template
			}
			save_scope_as = don_carlos_char		
		}
	}

	option = {
		name = cr_carlist_events.10.a
		custom_tooltip = {
			text = cr_carlist_events.10.a_tt
			abolish_the_basque_fueros_effect = yes
		}
		custom_tooltip = {
			text = cr_carlist_events.10.a_tt2
			abolish_the_catalan_fueros_effect = yes
		}
		#custom_tooltip = {
		#	text = cr_carlist_events.10.a_tt2
		#}
		scope:carlist_movement = {
			add_modifier = {
				name = cr_embrace_of_vergara	
			}
		}
		add_loyalists = {
			value = 0.15
			culture = cu:spanish
		}
		add_loyalists = {
			value = 0.1
			culture = cu:galician
		}
		
		ai_chance = {
			base = 80
		}
		default_option = yes
	}

	option = {
		name = cr_carlist_events.10.b
		custom_tooltip = {
			text = cr_carlist_events.10.b_tt
		}
		custom_tooltip = {
			text = cr_carlist_events.10.a_tt2
			abolish_the_catalan_fueros_effect = yes
		}
		custom_tooltip = {
			text = cr_carlist_events.10.b_tt2
		}
		scope:carlist_movement = {
			add_modifier = {
				name = cr_embrace_of_vergara	
			}
		}
		add_loyalists = {
			value = 0.05
			culture = cu:spanish
		}
		add_loyalists = {
			value = 0.05
			culture = cu:galician
		}
		add_loyalists = {
			value = 0.25
			culture = cu:basque
		}
		hidden_effect = {
			trigger_event = { id = cr_carlist_events.99 days = 0 }
			c:NAV = {
				add_loyalists = {
					value = 0.5
					culture = cu:basque
				}
			}
		}
		ai_chance = {
			base = 15
		}
	}

	option = {
		name = cr_carlist_events.10.c
		custom_tooltip = {
			text = cr_carlist_events.10.b_tt
		}
		custom_tooltip = {
			text = cr_carlist_events.10.c_tt
		}
		custom_tooltip = {
			text = cr_carlist_events.10.c_tt2
		}
		scope:carlist_movement = {
			add_modifier = {
				name = cr_embrace_of_vergara	
			}
		}
		add_radicals = {
			value = 0.05
			culture = cu:spanish
		}
		add_loyalists = {
			value = 0.25
			culture = cu:catalan
		}
		add_loyalists = {
			value = 0.10
			culture = cu:galician
		}
		add_loyalists = {
			value = 0.25
			culture = cu:basque
		}
		hidden_effect = {
			c:NAV = {
				add_loyalists = {
					value = 0.5
					culture = cu:basque
				}
			}
			c:CAT = {
				add_loyalists = {
					value = 0.5
					culture = cu:basque
				}
				add_loyalists = {
					value = 0.5
					culture = cu:catalan
				}
				add_radicals = {
					value = 0.15
					culture = cu:spanish
				}
			}
		}
		ai_chance = {
			base = 5
		}
	}
}

cr_carlist_events.15 = { #The Spanish Pretender / The King without a Country
	type = country_event
	placement = p:xBBF036

	title = cr_carlist_events.15.t
	desc = {
		first_valid = {
			triggered_desc = {
				desc = cr_carlist_events.15.desc_orleanist
				trigger = {
					has_law = law_type:law_monarchy
					ruler = {
						has_ideology = ideology:ideology_orleanist
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.15.desc_legitimist_absolutist
				trigger = {
					has_law = law_type:law_autocracy
					has_law = law_type:law_monarchy
					ruler = {
						has_ideology = ideology:ideology_legitimist
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.15.desc_legitimist
				trigger = {
					has_law = law_type:law_monarchy
					ruler = {
						has_ideology = ideology:ideology_legitimist
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.15.desc_bonapartist_absolutist
				trigger = {
					has_law = law_type:law_autocracy
					has_law = law_type:law_monarchy
					ruler = {
						has_ideology = ideology:ideology_bonapartist
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.15.desc_bonapartist
				trigger = {
					has_law = law_type:law_monarchy
					ruler = {
						has_ideology = ideology:ideology_bonapartist
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.15.desc_republic
				trigger = {
					OR = {
						has_law = law_type:law_presidential_republic
						has_law = law_type:law_parliamentary_republic
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.15.desc_fallback
			}
		}
	}
	flavor = {
		first_valid = {
			triggered_desc = {
				desc = cr_carlist_events.15.desc_orleanist_flavour
				trigger = {
					has_law = law_type:law_monarchy
					NOT = {
						has_law = law_type:law_autocracy
					}
					ruler = {
						has_ideology = ideology:ideology_orleanist
					}
				}
			}
			#triggered_desc = {
			#	desc = cr_carlist_events.15.desc_legitimist_absolutist_flavour
			#	trigger = {
			#		has_law = law_type:law_autocracy
			#		has_law = law_type:law_monarchy
			#		ruler = {
			#			has_ideology = ideology:ideology_legitimist
			#		}
			#	}
			#}
			triggered_desc = {
				desc = cr_carlist_events.15.desc_legitimist_flavour
				trigger = {
					has_law = law_type:law_monarchy
					ruler = {
						has_ideology = ideology:ideology_legitimist
					}
				}
			}
			#triggered_desc = {
			#	desc = cr_carlist_events.15.desc_bonapartist_absolutist_flavour
			#	trigger = {
			#		has_law = law_type:law_autocracy
			#		has_law = law_type:law_monarchy
			#		ruler = {
			#			has_ideology = ideology:ideology_bonapartist
			#		}
			#	}
			#}
			triggered_desc = {
				desc = cr_carlist_events.15.desc_bonapartist_flavour
				trigger = {
					has_law = law_type:law_monarchy
					ruler = {
						has_ideology = ideology:ideology_bonapartist
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.15.desc_republic_flavour
				trigger = {
					OR = {
						has_law = law_type:law_presidential_republic
						has_law = law_type:law_parliamentary_republic
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.15.flavour
			}
		}
	} 

	gui_window = event_window_1char_tabloid

	#left_icon = scope:don_carlos_char

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_military.dds"

	duration = 3

	trigger = {
	}

	immediate = {
		save_scope_as = don_carlos_exile_country
		c:SPA = {
			save_scope_as = spain
			random_political_movement = {
				limit = {
					is_political_movement_type = movement_carlists
				}
				save_scope_as = carlist_movement
			}
			random_political_movement = {
				limit = {
					is_political_movement_type = movement_christinos
				}
				save_scope_as = christinos_movement
			}
		}
		random_political_movement = {
			limit = {
				is_political_movement_type = movement_legitimist
			}
			save_scope_as = legitimist_movement
		}
		if = {
			limit = {
				any_scope_state = {
					state_region = s:STATE_ORLEANS
				}
			}
			p:xF6A48C = { # Bourges, or s:STATE_ORLEANS.region_state:FRA
				save_scope_as = don_carlos_exile_location
			}
			s:STATE_ORLEANS.region_state:FRA = {
				save_scope_as = don_carlos_exile_state
			}
			c:SPA = {
				set_variable = cr_don_carlos_exiled_bourges #for proper localisation
			}
		}
		else = {
			random_scope_state = {
				limit = {
					is_incorporated = yes
				}
			}
			save_scope_as = don_carlos_exile_location
			save_scope_as = don_carlos_exile_state
		}
	}

	#########################
	#   Orleanist Options   #
	#########################

	#option = {	#Grant Asylum—Help Restore a Constitutional Bourbon Monarchy - Not implementend. Should allow for a shift in Carlist ideology to more moderate absolutism
	#	name = cr_carlist_events.15.a.orleanist
	#	custom_tooltip = cr_carlist_events.15.a.orleanist_tt
	#	save_scope_as = don_carlos_exile_country
	#	trigger = {
	#		ruler = {
	#			has_ideology = ideology:ideology_orleanist
	#		}
	#		has_law = law_type:law_monarchy
	#	}
	#			
	#	ai_chance = {
	#		base = 85
	#	}
	#}
	option = {	#Grant Asylum, and Allow Him to Fade Into Obscurity (exile of Bourges)
		trigger = {
			ruler = {
				has_ideology = ideology:ideology_orleanist
			}
			has_law = law_type:law_monarchy
		}
		name = cr_carlist_events.15.b.orleanist
		custom_tooltip = cr_carlist_events.15.b.orleanist_tt
		save_scope_as = don_carlos_exile_country
		
		don_carlos_normal_exile_effect = yes
		c:SPA = { set_variable = don_carlist_orleanist_refuge }
		
		default_option = yes
		
		ai_chance = {
			base = 85
		}
	}
	option = { #Refuse Asylum—Don Carlos’ Rebellion Has Failed
		trigger = {
			ruler = {
				has_ideology = ideology:ideology_orleanist
			}
			has_law = law_type:law_monarchy
		}
		name = cr_carlist_events.15.c.orleanist
		custom_tooltip = cr_carlist_events.15.c.orleanist_tt
		don_carlos_reject_asylum_effect = yes
		
		ai_chance = {
			base = 85
		}
	}
	option = { #Support His Cause for the Rightful Bourbon Throne
		name = cr_carlist_events.15.d.orleanist
		custom_tooltip = cr_carlist_events.15.d.orleanist_tt
		trigger = {
			ruler = {
				has_ideology = ideology:ideology_orleanist
			}
			has_law = law_type:law_monarchy
		}
		don_carlos_support_claim_effect = yes
		c:SPA = { set_variable = don_carlist_orleanist_support }
		
		ai_chance = {
			base = 10
			modifier = {
				trigger = {
					is_at_war = yes
				}
				add = -5
			}
			modifier = {
				trigger = {
					has_law = law_type:law_autocracy
				}
				add = 10
			}
			modifier = {
				trigger = {
					infamy >= infamy_threshold:infamous
				}
				add = -50
			}
		}
	}

	#########################
	#   Legitimist Options  #
	#########################

	option = { #Offer Asylum and Support His Claim
		trigger = {
			ruler = {
				has_ideology = ideology:ideology_legitimist
			}
			has_law = law_type:law_monarchy
		}
		name = cr_carlist_events.15.a.legitimist
		custom_tooltip = cr_carlist_events.15.a.legitimist_tt
		don_carlos_support_claim_effect = yes

		c:SPA = { set_variable = don_carlist_legitimist_support }
		
		ai_chance = {
			base = 20
		}
	}
	option = { #Grant Asylum, but Remain Neutral
		trigger = {
			ruler = {
				has_ideology = ideology:ideology_legitimist
			}
			has_law = law_type:law_monarchy
		}
		name = cr_carlist_events.15.b.legitimist
		custom_tooltip = cr_carlist_events.15.b.legitimist_tt
		don_carlos_tacit_support_effect = yes
		c:SPA = { set_variable = don_carlist_legitimist_refuge }
		
		default_option = yes
		
		ai_chance = {
			base = 50
		}
	}
	option = { #Use His Presence to Embarrass the Spanish Government
		trigger = {
			ruler = {
				has_ideology = ideology:ideology_legitimist
			}
			has_law = law_type:law_monarchy
		}
		name = cr_carlist_events.15.c.legitimist
		custom_tooltip = cr_carlist_events.15.c.legitimist_tt
		c:SPA = { set_variable = don_carlist_legitimist_legitimacy_undermined }
		don_carlos_undermine_legitimacy_effect = yes
		
		ai_chance = {
			base = 30
		}
	}
	option = { #Refuse Asylum—He is a Failed Prince
		trigger = {
			ruler = {
				has_ideology = ideology:ideology_legitimist
			}
			has_law = law_type:law_monarchy
		}
		name = cr_carlist_events.15.d.legitimist
		custom_tooltip = cr_carlist_events.15.d.legitimist_tt
		don_carlos_reject_asylum_effect = yes
		
		ai_chance = {
			base = 5
		}
	}
	
	##########################
	#   Bonapartist Options  #
	##########################
	
	#Regular
	option = { #Grant Asylum, But No Support for His Cause
		trigger = {
			ruler = {
				has_ideology = ideology:ideology_bonapartist
			}
			has_law = law_type:law_monarchy
		}
		name = cr_carlist_events.15.a.bonapartist
		custom_tooltip = cr_carlist_events.15.a.bonapartist_tt
		don_carlos_normal_exile_effect = yes
		
		ai_chance = {
			base = 40
		}
	}
	option = { #Use His Presence to Embarrass the Old Monarchies
		trigger = {
			ruler = {
				has_ideology = ideology:ideology_bonapartist
			}
			has_law = law_type:law_monarchy
		}
		name = cr_carlist_events.15.b.bonapartist
		custom_tooltip = cr_carlist_events.15.b.bonapartist_tt
		don_carlos_undermine_legitimacy_effect = yes
		c:SPA = { set_variable = don_carlist_bonapartist_legitimacy_undermined }
		
		ai_chance = {
			base = 20
		}
	}
	option = { #Refuse Him—No Room for Royalist Plots
		trigger = {
			ruler = {
				has_ideology = ideology:ideology_bonapartist
			}
			has_law = law_type:law_monarchy
		}
		name = cr_carlist_events.15.d.bonapartist
		custom_tooltip = cr_carlist_events.15.d.bonapartist_tt
		don_carlos_reject_asylum_effect = yes
		default_option = yes
		
		ai_chance = {
			base = 40
		}
	}
	
	##########################
	#    Republic Options 	 #
	##########################
	
	option = {
		name = cr_carlist_events.15.a.fallback
		trigger = {
			OR = {
				has_law = law_type:law_presidential_republic
				has_law = law_type:law_parliamentary_republic
			}
		}
		don_carlos_normal_exile_effect = yes
		default_option = yes
		
		ai_chance = {
			base = 40
		}
	}
	
	#option = {
	#	name = cr_carlist_events.15.b
	#	trigger = {
	#		OR = {
	#			has_law = law_type:law_presidential_republic
	#			has_law = law_type:law_parliamentary_republic
	#		}
	#	}
	#	c:SPA = {
	#		trigger_event = { id =  cr_carlist_events.20 days = 5 }
	#	}
	#	show_as_tooltip = {
	#		c:SPA = {
	#			change_relations = {
	#				country = ROOT
	#				value = -50
	#			}
	#		}
	#	}
	#	if = {
	#		limit = {
	#			c:SIC = {
	#				has_law = law_type:law_monarchy
	#			}
	#		}
	#		c:SIC = {
	#			change_relations = {
	#				country = ROOT
	#				value = 15
	#			}
	#		}
	#	}
	#	show_as_tooltip = {
	#		scope:carlist_movement = {
	#			add_modifier = {
	#				name = cr_don_carlos_absolutist_support	
	#			}
	#		}
	#	}
	#	default_option = yes
	#	
	#	ai_chance = {
	#		base = 70
	#	}
	#}
	
	option = {
		name = cr_carlist_events.15.c
		trigger = {
			OR = {
				has_law = law_type:law_presidential_republic
				has_law = law_type:law_parliamentary_republic
			}
		}
		don_carlos_reject_asylum_effect = yes
		ai_chance = {
			base = 60
		}
	}
}

cr_carlist_events.20 = { #The Exile of [Bourges] - Spain reaction event to Carlos having been granted asylum somewhere - 1char window
	type = country_event
	placement = scope:don_carlos_exile_location
	
	title = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_variable = cr_don_carlos_exiled_australia
				}
				desc = cr_carlist_events.20.t_australia
			}
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = c:POR
				}
				desc = cr_carlist_events.20.t_portugal_exile
			}
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = c:USA
				}
				desc = cr_carlist_events.20.t_USA_exile
			}
			triggered_desc = {
				desc = cr_carlist_events.20.t_bourges
				trigger = {
					has_variable = cr_don_carlos_exiled_bourges
				}
			}
			#triggered_desc = {
			#	trigger = {
			#		scope:don_carlos_exile_country = c:AUS
			#	}
			#	desc = cr_carlist_events.20.t_austria
			#}
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = c:RUS
					has_variable = don_carlos_distant_exile_var
				}
				desc = cr_carlist_events.20.t_russia
			}
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.20.t
			}
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				desc = cr_carlist_events.20.desc_australia
				trigger = {
					has_variable = cr_don_carlos_exiled_australia
				}
			}
			#Portugal action text
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:POR
					}
				}
				desc = cr_carlist_events.20.t_portugal_exile
			}
			#USA actoin text
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:USA
					}
				}
				desc = cr_carlist_events.20.desc_USA_exile
			}
			#Orleanist action text
			triggered_desc = { 
				trigger = {
					has_variable = don_carlist_orleanist_refuge
					has_variable = cr_don_carlos_exiled_bourges
				}
				desc = cr_carlist_events.20.desc_france_orleanist_bourges
			}
			triggered_desc = {
				trigger = {
					has_variable = don_carlist_orleanist_refuge
				}
				desc = cr_carlist_events.20.desc_france_orleanist_generic
			}
			triggered_desc = {
				trigger = {
					has_variable = don_carlist_legitimist_refuge
				}
				desc = cr_carlist_events.20.desc_france_legitimist_refuge
			}
			#Bonapartist descriptions
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:FRA
						ruler = {
							has_ideology = ideology:ideology_bonapartist
						}
					}
					has_variable = cr_exile_of_bourges_var
				}
				desc = cr_carlist_events.20.desc_france_bonapartist_refuge
			}
			#French Republic description
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:FRA
						NOT = {
							has_law = law_type:law_monarchy
						}
					}
				}
				desc = cr_carlist_events.20.desc_republic
			}
			#Britain Descriptions
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:GBR
						NOT = {
							has_law = law_type:law_autocracy
						}
					}
				}
				desc = cr_carlist_events.20.desc_britian_hmgovernment
			}
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:GBR
					}
				}
				desc = cr_carlist_events.20.desc_britian_generic
			}
			#Naples Descriptions
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:SIC
					}
				}
				desc = cr_carlist_events.20.desc_two_sicilies
			}
			#Austria Descriptions
			triggered_desc = {
				trigger = {
					has_variable = cr_metternichs_gambit_var
				}
				desc = cr_carlist_events.20.desc_austria_metternich
			}
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:AUS
					}
				}
				desc = cr_carlist_events.20.desc_austria
			}
			#Russia Descriptions
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = c:RUS
					has_variable = don_carlos_distant_exile_var
				}
				desc = cr_carlist_events.20.desc_russia
			}
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = c:RUS
				}
				desc = cr_carlist_events.20.desc_russia_exile
			}
			
			#Fallback
			
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.20.desc_neutral
			}
		}
	}
	
	flavor = { 
		first_valid = {
			triggered_desc = {
				trigger = {
					has_variable = cr_don_carlos_exiled_australia
				}
				desc = cr_carlist_events.20.flavour_australia
			}
			#Portugal flavour text
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:POR
					}
				}
				desc = cr_carlist_events.20.flavour_portugal_exile
			}
			#USA exile location
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:USA
					}
				}
				desc = cr_carlist_events.90.flavour
			}
			#Orleanist flavour text
			triggered_desc = {
				trigger = {
					has_variable = don_carlist_orleanist_refuge
					has_variable = cr_don_carlos_exiled_bourges
				}
				desc = cr_carlist_events.20.desc_france_orleanist_bourges_flavour
			}
			triggered_desc = {
				trigger = {
					has_variable = don_carlist_orleanist_refuge
				}
				desc = cr_carlist_events.20.desc_france_orleanist_generic_flavour
			}
			#Legitimist flavour
			triggered_desc = {
				trigger = {
					has_variable = don_carlist_legitimist_refuge
					has_variable = cr_don_carlos_exiled_bourges
				}
				desc = cr_carlist_events.20.desc_france_legitimist_bourges_flavour
			}
			triggered_desc = {
				trigger = {
					has_variable = don_carlist_legitimist_refuge
				}
				desc = cr_carlist_events.20.desc_france_legitimist_generic_flavour
			}
			#Bonapartist Flavour
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:FRA
						ruler = {
							has_ideology = ideology:ideology_bonapartist
						}
					}
					has_variable = cr_exile_of_bourges_var
				}
				desc = cr_carlist_events.20.desc_france_bonapartist_refuge_flavour
			}
			#French Republic descriptions
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:FRA
						NOT = {
							has_law = law_type:law_monarchy
						}
					}
					has_variable = cr_exile_of_bourges_var
				}
				desc = cr_carlist_events.20.desc_republic_flavour_bourgos
			}
			#French Republic description
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:FRA
						NOT = {
							has_law = law_type:law_monarchy
						}
					}
					NOT = { has_variable = cr_exile_of_bourges_var }
				}
				desc = cr_carlist_events.20.desc_republic_flavour_generic
			}
			#Britain Flavour
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:GBR
					}
				}
				desc = cr_carlist_events.20.desc_britain_flavour
			}
			#Naples Flavour
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:SIC
					}
				}
				desc = cr_carlist_events.20.flavour_two_sicilies
			}
			#Austria Flavour
			triggered_desc = {
				trigger = {
					has_variable = cr_metternichs_gambit_var
				}
				desc = cr_carlist_events.20.flavour_austria_metternich
			}
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:AUS
					}
				}
				desc = cr_carlist_events.20.flavour_austria
			}
			#Russia Flavour
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = c:RUS
					has_variable = don_carlos_distant_exile_var
				}
				desc = cr_carlist_events.20.flavour_russia
			}
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = c:RUS
				}
				desc = cr_carlist_events.20.flavour_russia_exile
			}
			
			#Fallback
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.20.flavour
			}
		}
	}

	gui_window = event_window_1char_tabloid

	#left_icon = scope:don_carlos_char

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"


	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 3

	trigger = {
	}

	immediate = {
		clear_saved_scope = carlist_movement
		random_political_movement = {
			limit = {
				is_political_movement_type = movement_carlists
			}
			save_scope_as = carlist_movement
		}
		add_journal_entry = {
			type = je_cr_carlist_question_christinos		
		}
		if = {
			limit = {
				scope:don_carlos_exile_country = {
					this = c:AUS
					any_scope_character = {
						has_template = ecchi_aus_metternich_character_template
					}
				}
			}
			scope:don_carlos_exile_country = {
				random_scope_character = {
					limit = {
						has_template = ecchi_aus_metternich_character_template
					}
					save_scope_as = don_carlos_supporting_politician
				}
			}
			set_variable = cr_metternichs_gambit_var
		}
		else = {
			scope:don_carlos_exile_country = {
				ruler = {
					save_scope_as = don_carlos_supporting_politician
				}
			}
		}
	}

	option = {
		name = cr_carlist_events.20.a
		default_option = yes
		
		don_carlos_glad_to_be_rid_of_him = yes
		
		ai_chance = {
			base = 50
			modifier = {
				trigger = {
					has_variable = cr_exile_of_bourges_var
					scope:don_carlos_exile_country = {
						ruler = {
							has_ideology = ideology:ideology_orleanist
						}
					}
				}
				add = 30
			}
			modifier = {
				trigger = {
					OR = {
						has_variable = don_carlos_supported_by_absolutists_var
						has_variable = don_carlos_legitimacy_underminded_var
					}	
				}
				add = -40
			}
		}
	}

	option = {
		name = cr_carlist_events.20.b
		don_carlos_out_of_our_reach = yes
		scope:don_carlos_exile_country = {
			post_notification = cr_don_carlos_exile_negative_reaction
		}
		ai_chance = {
			base = 50
			modifier = {
				trigger = {
					has_variable = cr_exile_of_bourges_var
					scope:don_carlos_exile_country = {
						ruler = {
							has_ideology = ideology:ideology_orleanist
						}
					}
				}
				add = -30
			}
			modifier = {
				trigger = {
					OR = {
						has_variable = don_carlos_supported_by_absolutists_var
						has_variable = don_carlos_legitimacy_underminded_var
					}	
				}
				add = 40
			}
		}
	}

	option = {
		name = cr_carlist_events.20.c
		trigger = {
			scope:don_carlos_exile_country = {
				this = c:POR
			}
			has_variable = don_carlos_supported_by_absolutists_var
		}
		scope:don_carlos_exile_country = {
			post_notification = cr_don_carlos_exile_support_liberalism
		}
		set_variable = cr_carlos_supporting_liberalism_in_portugal_var
		scope:carlist_movement = {
			add_modifier = {
				name = cr_don_carlos_absolutist_support	
			}
		}
		scope:liberal_movement = {
			add_modifier = {
				name = cr_don_carlos_liberal_support	
			}		
		}
		add_modifier = {
			name = cr_carlos_supporting_liberalism
		}
		change_relations = {
			country = c:POR
			value = -75
		}
		ai_chance = {
			base = 25
			modifier = {
				trigger = {
					infamy >= infamy_threshold:infamous
				}
				add = -20
			}
			modifier = {
				trigger = {
					infamy >= infamy_threshold:notorious
				}
				add = -100
			}
			modifier = {
				trigger = {
					authority < 300
				}
				add = -20
			}
			modifier = {
				trigger = {
					authority < 200
				}
				add = -20
			}
		}
	}
}

cr_carlist_events.21 = { #The Exile of [Bourges] - Spain reaction event to Carlos having been granted asylum somewhere - 2char window
	type = country_event
	placement = scope:don_carlos_exile_location
	
	title = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = c:POR
					has_variable = don_carlos_supported_by_absolutists_var
				}
				desc = cr_carlist_events.21.t_portugal_support
			}
			triggered_desc = {
				desc = cr_carlist_events.20.t_bourges
				trigger = {
					has_variable = cr_don_carlos_exiled_bourges
				}
			}
			triggered_desc = {
				trigger = {
					has_variable = cr_metternichs_gambit_var
				}
				desc = cr_carlist_events.21.t_austria_metternich
			}
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = c:AUS
				}
				desc = cr_carlist_events.21.t_austria
			}
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = c:RUS
				}
				desc = cr_carlist_events.21.t_russia
			}
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.20.t
			}
		}
	}
	desc = {
		first_valid = {
			#Portugal exile location
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:POR
					}
					has_variable = don_carlos_supported_by_absolutists_var
				}
				desc = cr_carlist_events.21.desc_portugal
			}
			#Orleanist action text
			triggered_desc = {
				trigger = {
					has_variable = don_carlist_orleanist_support
				}
				desc = cr_carlist_events.21.desc_france_orleanist
			}
			#Legitimist action text
			triggered_desc = {
				trigger = {
					has_variable = cr_don_carlos_exiled_bourges
					has_variable = don_carlist_legitimist_support
				}
				desc = cr_carlist_events.21.desc_france_legitimist
			}
			triggered_desc = {
				trigger = {
					has_variable = don_carlist_legitimist_support
				}
				desc = cr_carlist_events.21.desc_france_legitimist
			}
			triggered_desc = {
				trigger = {
					has_variable = don_carlist_legitimist_legitimacy_undermined
				}
				desc = cr_carlist_events.21.desc_france_legitimist_undermine_legitimacy
			}
			#Bonapartist descriptions
			triggered_desc = {
				trigger = {
					has_variable = don_carlist_bonapartist_legitimacy_undermined
				}
				desc = cr_carlist_events.21.desc_france_bonapartist_legitimacy_undermined
			}
			#Naples Description
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:SIC
					}
				}
				desc = cr_carlist_events.21.desc_two_sicilies
			}
			#Austria Descriptions
			triggered_desc = {
				trigger = {
					has_variable = cr_metternichs_gambit_var
				}
				desc = cr_carlist_events.21.desc_austria_metternich
			}
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:AUS
					}
				}
				desc = cr_carlist_events.21.desc_austria
			}
			#Russia Flavour
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:RUS
					}
				}
				desc = cr_carlist_events.21.desc_russia
			}
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.20.desc_neutral
			}
		}
	}
	
	flavor = { 
		first_valid = {
			triggered_desc = {
				trigger = {
					has_variable = cr_don_carlos_exiled_australia
				}
				desc = cr_carlist_events.20.flavour_australia
			}
			#Portugal exile location
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:POR
					}
					has_variable = don_carlos_supported_by_absolutists_var
				}
				desc = cr_carlist_events.21.flavour_portugal
			}
			#Orleanist flavour text
			triggered_desc = {
				trigger = {
					has_variable = don_carlist_orleanist_support
				}
				desc = cr_carlist_events.21.flavour_france_orleanist
			}
			#Legitimist flavour
			triggered_desc = {
				trigger = {
					has_variable = don_carlist_legitimist_support
				}
				desc = cr_carlist_events.21.flavour_france_legitimist
			}
			triggered_desc = {
				trigger = {
					has_variable = don_carlist_legitimist_legitimacy_undermined
				}
				desc = cr_carlist_events.21.flavour_france_legitimist_undermine_legitimacy
			}
			#Bonapartist Flavour
			triggered_desc = {
				trigger = {
					has_variable = don_carlist_bonapartist_legitimacy_undermined
				}
				desc = cr_carlist_events.21.desc_france_bonapartist_legitimacy_undermined_flavour
			}
			#Naples Flavour
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:SIC
					}
				}
				desc = cr_carlist_events.21.flavour_two_sicilies
			}
			#Austria Flavour
			triggered_desc = {
				trigger = {
					has_variable = cr_metternichs_gambit_var
				}
				desc = cr_carlist_events.21.flavour_austria_metternich
			}
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:AUS
					}
				}
				desc = cr_carlist_events.21.flavour_austria
			}
			#Russia Flavour
			triggered_desc = {
				trigger = {
					scope:don_carlos_exile_country = {
						this = c:RUS
					}
				}
				desc = cr_carlist_events.21.flavour_russia
			}
			
			#Fallback
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.20.flavour
			}
		}
	}

	gui_window = event_window_2char

	#left_icon = scope:don_carlos_char
	right_icon = scope:don_carlos_supporting_politician

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"


	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 3

	trigger = {
	}

	immediate = {
		clear_saved_scope = carlist_movement
		random_political_movement = {
			limit = {
				is_political_movement_type = movement_carlists
			}
			save_scope_as = carlist_movement
		}
		add_journal_entry = {
			type = je_cr_carlist_question_christinos		
		}
		if = {
			limit = {
				scope:don_carlos_exile_country = {
					this = c:AUS
					any_scope_character = {
						has_template = ecchi_aus_metternich_character_template
					}
				}
			}
			scope:don_carlos_exile_country = {
				random_scope_character = {
					limit = {
						has_template = ecchi_aus_metternich_character_template
					}
					save_scope_as = don_carlos_supporting_politician
				}
			}
			set_variable = cr_metternichs_gambit_var
		}
		else = {
			scope:don_carlos_exile_country = {
				ruler = {
					save_scope_as = don_carlos_supporting_politician
				}
			}
		}
	}

	option = {
		name = cr_carlist_events.20.a
		default_option = yes
		
		don_carlos_glad_to_be_rid_of_him = yes
		
		ai_chance = {
			base = 50
			modifier = {
				trigger = {
					has_variable = cr_exile_of_bourges_var
					scope:don_carlos_exile_country = {
						ruler = {
							has_ideology = ideology:ideology_orleanist
						}
					}
				}
				add = 30
			}
			modifier = {
				trigger = {
					OR = {
						has_variable = don_carlos_supported_by_absolutists_var
						has_variable = don_carlos_legitimacy_underminded_var
					}	
				}
				add = -40
			}
		}
	}

	option = {
		name = cr_carlist_events.20.b
		don_carlos_out_of_our_reach = yes
		scope:don_carlos_exile_country = {
			post_notification = cr_don_carlos_exile_negative_reaction
		}
		ai_chance = {
			base = 50
			modifier = {
				trigger = {
					has_variable = cr_exile_of_bourges_var
					scope:don_carlos_exile_country = {
						ruler = {
							has_ideology = ideology:ideology_orleanist
						}
					}
				}
				add = -30
			}
			modifier = {
				trigger = {
					OR = {
						has_variable = don_carlos_supported_by_absolutists_var
						has_variable = don_carlos_legitimacy_underminded_var
					}	
				}
				add = 40
			}
		}
	}

	option = {
		name = cr_carlist_events.20.c
		trigger = {
			scope:don_carlos_exile_country = {
				this = c:POR
			}
			has_variable = don_carlos_supported_by_absolutists_var
		}
		scope:don_carlos_exile_country = {
			post_notification = cr_don_carlos_exile_support_liberalism
		}
		set_variable = cr_carlos_supporting_liberalism_in_portugal_var
		scope:carlist_movement = {
			add_modifier = {
				name = cr_don_carlos_absolutist_support	
			}
		}
		scope:liberal_movement = {
			add_modifier = {
				name = cr_don_carlos_liberal_support	
			}		
		}
		add_modifier = {
			name = cr_carlos_supporting_liberalism
		}
		change_relations = {
			country = c:POR
			value = -75
		}
		ai_chance = {
			base = 25
			modifier = {
				trigger = {
					infamy >= infamy_threshold:infamous
				}
				add = -20
			}
			modifier = {
				trigger = {
					infamy >= infamy_threshold:notorious
				}
				add = -100
			}
			modifier = {
				trigger = {
					authority < 300
				}
				add = -20
			}
			modifier = {
				trigger = {
					authority < 200
				}
				add = -20
			}
		}
	}
}
cr_carlist_events.22 = { #The Drowned Crown - Fallback for if Carlos cannot find a home.
	type = country_event
	placement = scope:don_carlos_exile_location
	
	title = cr_carlist_events.22.t
	desc = cr_carlist_events.22.desc
	flavor = cr_carlist_events.22.flavour

	gui_window = event_window_1char_tabloid

	#left_icon = scope:don_carlos_char

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"


	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 3

	trigger = {
	}

	immediate = {
	}

	option = {
		name = cr_carlist_events.22.a
		custom_tooltip = cr_carlist_events.22.a_tt
		default_option = yes
		
		scope:don_carlos_char = {
			kill_character = yes
		}
		custom_tooltip = {
			text = cr_carlist_events.22.a_tt2
			scope:carlist_movement = {
				set_variable = cr_carlists_question_ended_var
			}
			set_variable = cr_carlists_question_ended_var
		}
		create_political_movement = { type = movement_royalist_absolutist }
		show_as_tooltip = {
			create_political_movement = { 
				type = movement_religious_majority
				religion = owner.religion 
			}
		}
		don_carlos_final_cleanup_vars = yes
	}
}

cr_carlist_events.25 = { #The Triumph of the Old Order
	type = country_event
	placement = p:xABE0B3

	title = cr_carlist_events.25.t
	desc = cr_carlist_events.25.desc
	flavor = cr_carlist_events.25.flavour

	event_image = {
		video = "unspecific_military_parade"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	#on_opened_soundeffect = "event:/SFX/Events/unspecific/trains"

	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	duration = 3

	trigger = {
	}

	immediate = {
        remove_variable = cr_carlist_war_ongoing
        c:SPA = { remove_variable = cr_carlist_war_ongoing }
		create_country = {
			origin = this
			tag = NAV
			state = s:STATE_NAVARRA.region_state:SPA
		}
		c:NAV = {
			activate_law = law_type:law_monarchy
			activate_law = law_type:law_oligarchy
			activate_law = law_type:law_ethnostate
			activate_law = law_type:law_state_religion
			activate_law = law_type:law_hereditary_bureaucrats
			activate_law = law_type:law_national_militia
			activate_law = law_type:law_free_trade
			activate_law = law_type:law_traditionalism
			activate_law = law_type:law_homesteading
		}
		create_diplomatic_pact = {
			country = c:NAV
			type = personal_union
		}
		c:NAV = {
			save_scope_as = cr_kingdom_of_navarra
		}
		s:STATE_NAVARRA.region_state:NAV = {
			save_scope_as = cr_state_navarra
		}
		c:SPA = {
			save_scope_as = cr_christinos
			ig:ig_intelligentsia = {
				save_scope_as = cr_spanish_liberals
			}
			ig:ig_devout = {
				save_scope_as = cr_spanish_catholic_church
			}
			ig:ig_landowners = {
				save_scope_as = cr_spanish_landowners
			}
			
			ig:ig_rural_folk = {
			}
			
			ig:ig_petty_bourgeoisie = {
			}
		}
		c:CSP = {
			save_scope_as = cr_carlists
		}
		cu:basque = {
			save_scope_as = cr_basque_culture
		}
		cu:catalan = {
			save_scope_as = cr_catalan_culture
		}
	}

	option = {
		name = cr_carlist_events.25.a
		custom_tooltip = {
			text = cr_carlist_events.25.a_tt
		}
		add_loyalists = {
			value = 0.05
			culture = cu:spanish
		}
		add_loyalists = {
			value = 0.10
			culture = cu:catalan
		}
		add_loyalists = {
			value = 0.10
			culture = cu:galician
		}
		add_loyalists = {
			value = 0.25
			culture = cu:basque
		}
		hidden_effect = {
			trigger_event = { id = cr_carlist_events.99 days = 0 }
		}
		ai_chance = {
			base = 60
		}
		default_option = yes
	}

	option = {
		name = cr_carlist_events.25.b
		custom_tooltip = {
			text = cr_carlist_events.25.b_tt
			annex = c:NAV
		}
		
		add_loyalists = {
			value = 0.15
			culture = cu:spanish
		}
		add_loyalists = {
			value = 0.05
			culture = cu:catalan
		}
		add_loyalists = {
			value = 0.05
			culture = cu:galician
		}
		add_radicals = {
			value = 0.40
			culture = cu:basque
		}
		hidden_effect = {
			trigger_event = { id = cr_carlist_events.99 days = 0 }
		}
		
		ai_chance = {
			base = 40
		}
	}
}

#############################
#							#
# Carlos to Britain branch	#
#							#
#############################

cr_carlist_events.30 = { #The Spanish Pretender / The King without a Country - Britain
	type = country_event
	placement = scope:don_carlos_arrival_location

	title = cr_carlist_events.30.t
	desc = {
		first_valid = {
			triggered_desc = {
				desc = cr_carlist_events.30.desc_legitimist_or_orleanist_1_monarchy
				trigger = {
					has_law = law_type:law_monarchy
					scope:don_carlos_exile_rejected = {
						has_law = law_type:law_monarchy
						ruler = {
							OR = {
								has_ideology = ideology:ideology_orleanist
								has_ideology = ideology:ideology_legitimist
							}
						}
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.30.desc_monarchy_first_visit
				trigger = {
					has_law = law_type:law_monarchy
					scope:don_carlos_exile_rejected = {
						exists = yes
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.30.desc_monarchy_first_visit
				trigger = {
					has_law = law_type:law_monarchy
					scope:don_carlos_exile_rejected = {
						exists = no
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.30.desc_neutral_1_republic
				trigger = {
					NOT = { has_law = law_type:law_monarchy }
					scope:don_carlos_exile_rejected = {
						exists = yes
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.30.desc_neutral_republic
				trigger = {
					NOT = { has_law = law_type:law_monarchy } 
					scope:don_carlos_exile_rejected = {
						exists = no
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.30.desc_fallback
				trigger = {
					always = yes
				}
			}
		}
	}
	flavor = cr_carlist_events.30.flavour

	gui_window = event_window_1char_tabloid

	#left_icon = scope:don_carlos_char

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 3

	trigger = {
	}

	immediate = {
		save_scope_as = don_carlos_exile_country
		if = {
			limit = {
				any_scope_state = {
					state_region = s:STATE_WEST_COUNTRY
				}
			}
			p:x63EF7E = {
				save_scope_as = don_carlos_arrival_location
			}
			random_scope_state = {
				limit = {
					state_region = s:STATE_WEST_COUNTRY
				}
				save_scope_as = carlos_arrival_state
			}
			random_scope_state = {
				limit = {
					is_incorporated = yes
				}
				save_scope_as = don_carlos_exile_location
				save_scope_as = don_carlos_exile_state
			}
		}
		else = {
			random_scope_state = {
				limit = {
					is_incorporated = yes
					is_coastal = yes
				}
				save_scope_as = don_carlos_arrival_location
				save_scope_as = carlos_arrival_state
				save_scope_as = don_carlos_exile_state
				save_scope_as = don_carlos_exile_location
			}
		}
		random_subject_or_below = {
			limit = {
				any_scope_state = {
					region = sr:region_oceania
				}
				is_subject_type = subject_type_colony
			}
			save_scope_as = australian_destination
		}
	}

	option = {
		name = cr_carlist_events.30.a
		don_carlos_reject_asylum_effect = yes
		default_option = yes
		
		ai_chance = {
			base = 75
		}
	}

	option = {
		name = cr_carlist_events.30.b
		don_carlos_normal_exile_effect = yes
		
		ai_chance = {
			base = 5
		}
	}

	option = {
		name = cr_carlist_events.30.c
		clear_saved_scope = don_carlos_exile_location
		clear_saved_scope = don_carlos_exile_state
		clear_saved_scope = carlos_arrival_state
		trigger = {
			any_subject_or_below = {
				any_scope_state = {
					region = sr:region_oceania
				}
				is_subject_type = subject_type_colony
			}
		}
		scope:australian_destination = {
			trigger_event = {
				id = cr_carlist_events.31
				days = 7
			}
		}
		#show_as_tooltip = {
		#	c:SPA = {
		#		change_relations = {
		#			country = ROOT
		#			value = -5
		#		}
		#	}
		#}
		#c:SPA = {
		#
		#}
		
		ai_chance = {
			base = 20
		}
	}
}

cr_carlist_events.31 = { #The Spanish Pretender / An Unwelcome Guest - Exile to Australia
	type = country_event
	placement = ROOT

	title = cr_carlist_events.31.t
	desc = {
		first_valid = {
			triggered_desc = {
				desc = cr_carlist_events.31.desc_hmgovernment
				trigger = {
					top_overlord = {
						has_law = law_type:law_monarchy
						NOT = {
							has_law = law_type:law_autocracy
						}
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.31.desc_generic
				trigger = {
					always = yes
				}
			}
		}
	}
	flavor = cr_carlist_events.31.flavour

	gui_window = event_window_1char_tabloid

	#left_icon = scope:don_carlos_char

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 3
	
	trigger = {
	}

	immediate = {
		save_scope_as = australia
		capital = {
			save_scope_as = don_carlos_exile_location
			save_scope_as = don_carlos_exile_state
		}
		c:SPA = {
			set_variable = cr_don_carlos_exiled_australia
		}
	}

	option = {
		name = cr_carlist_events.31.a
		custom_tooltip = {
			text = cr_carlist_events.31.a_tt
			top_overlord = {
				save_scope_as = don_carlos_exile_country
			}
		}
		don_carlos_distant_exile_effect = yes
		default_option = yes
		ai_chance = {
			base = 70
		}
	}

	option = {
		name = cr_carlist_events.31.b
		custom_tooltip = {
			text = cr_carlist_events.31.b_tt
			top_overlord = {
				save_scope_as = don_carlos_exile_country
			}
		}
		don_carlos_distant_exile_effect = yes
		#Chance of a minor Carlist support event later (e.g., a group of settlers advocating for him)
		ai_chance = {
			base = 30
		}
	}

	#option = {	#You don't get to reject a British order here.
	#	name = cr_carlist_events.31.c
	#	custom_tooltip = {
	#		text = cr_carlist_events.31.c_tt
	#	}
	#	clear_saved_scope = don_carlos_exile_location
	#	clear_saved_scope = don_carlos_exile_state
	#	top_overlord = {
	#		change_relations = {
	#			country = ROOT
	#			value = -5
	#		}
	#		random_subject_or_below = {
	#			limit = {
	#				any_scope_state = {
	#					region = sr:region_oceania
	#				}
	#				NOT = { this = ROOT }
	#				is_subject_type = subject_type_colony
	#			}
	#			trigger_event = {
	#				id = cr_carlist_events.31
	#				days = 3
	#			}
	#		}
	#	}
	#	ai_chance = {
	#		base = 0
	#	}
	#}
}
#############################
#							#
#  Carlos to Russia branch	#
#							#
#############################
cr_carlist_events.50 = { #A Hapsburg Haven - No Metternich
	type = country_event
	placement = scope:don_carlos_arrival_location

	title = cr_carlist_events.50.t
	desc = cr_carlist_events.50.desc
	flavor = cr_carlist_events.50.flavour

	gui_window = event_window_1char_tabloid

	#left_icon = scope:don_carlos_char
	right_icon = scope:don_carlos_supporting_politician

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 3
	
	trigger = {
	}

	immediate = {
		save_scope_as = don_carlos_exile_country
		ruler = {
			save_scope_as = don_carlos_supporting_politician
		}
		capital = {
			save_scope_as = don_carlos_arrival_location
			save_scope_as = carlos_arrival_state
		}
		if = {
			limit = {
				any_scope_state = {
					state_region = s:STATE_TOMSK
				}
			}
			random_scope_state = {
				limit = {
					state_region = s:STATE_TOMSK
				}
				save_scope_as = don_carlos_exile_location
				save_scope_as = don_carlos_exile_state
			}
		}
		else_if = {
			limit = {
				any_scope_state = {
					region = sr:region_west_siberia	
				}
			
			}
			random_scope_state = {
				limit = {
					region = sr:region_west_siberia
				}
				save_scope_as = don_carlos_exile_location
				save_scope_as = don_carlos_exile_state
			}
		
		}
		else = {
			random_scope_state = {
				save_scope_as = don_carlos_exile_location
				save_scope_as = don_carlos_exile_state
			}
		}
	}

	option = {
		name = cr_carlist_events.50.a
		custom_tooltip = {
			text = cr_carlist_events.50.a_tt
		}
		don_carlos_support_claim_effect = yes
		default_option = yes
		
		remove_variable = cr_metternichs_gambit_var
		ai_chance = {
			base = 70
		}
	}

	option = {
		name = cr_carlist_events.50.b
		custom_tooltip = {
			text = cr_carlist_events.50.b_tt
		}
		trigger = {
			any_scope_state = {
				region = sr:region_west_siberia
			}
		}
		don_carlos_distant_exile_effect = yes

		ai_chance = {
			base = 30
		}
	}

	option = {
		name = cr_carlist_events.50_exile.b
		custom_tooltip = {
			text = cr_carlist_events.50.b_exile_tt
		}
		trigger = {
			NOT = {
				any_scope_state = {
					region = sr:region_west_siberia
				}
			}
		}
		don_carlos_normal_exile_effect = yes
		
		
		ai_chance = {
			base = 30
		}
	}

	option = {
		name = cr_carlist_events.50.c
		custom_tooltip = {
			text = cr_carlist_events.50.c_tt
		}
		don_carlos_reject_asylum_effect = yes
	}
}




#############################
#							#
# Carlos to Austria branch	#
#							#
#############################

cr_carlist_events.60 = { #A Habsburg Haven
	type = country_event
	placement = scope:don_carlos_arrival_location

	title = cr_carlist_events.60.t
	desc = cr_carlist_events.60.desc
	flavor = cr_carlist_events.60.flavour

	gui_window = event_window_2char

	#left_icon = scope:don_carlos_char
	right_icon = scope:don_carlos_supporting_politician

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 3
	
	trigger = {
	}

	immediate = {
		save_scope_as = don_carlos_exile_country
		capital = {
			save_scope_as = don_carlos_arrival_location
			save_scope_as = carlos_arrival_state
		}
		if = {
			limit = {
				any_scope_character = {
					has_template = ecchi_aus_metternich_character_template
				}
			}
			random_scope_character = {
				limit = {
					has_template = ecchi_aus_metternich_character_template
				}
				save_scope_as = don_carlos_supporting_politician
			}
			set_variable = cr_metternichs_gambit_var
		}
		else = {
			ruler = {
				save_scope_as = don_carlos_supporting_politician
			}
		}
	}

	option = {
		name = cr_carlist_events.60.a
		custom_tooltip = {
			text = cr_carlist_events.60.a_tt
		}
		don_carlos_normal_exile_effect = yes
		default_option = yes
		
		remove_variable = cr_metternichs_gambit_var
		ai_chance = {
			base = 60
		}
	}

	option = {
		name = cr_carlist_events.60.b
		custom_tooltip = {
			text = cr_carlist_events.60.b_tt
			top_overlord = {
				save_scope_as = don_carlos_exile_country
			}
		}
		don_carlos_undermine_legitimacy_effect = yes
		clear_saved_scope = don_carlos_exile_location
		capital = {
			save_scope_as = don_carlos_exile_location
		}
		
		remove_variable = cr_metternichs_gambit_var
		ai_chance = {
			base = 25
		}
	}

	option = {
		name = cr_carlist_events.60.c
		custom_tooltip = {
			text = cr_carlist_events.60.c_tt
		}
		don_carlos_reject_asylum_effect = yes
		
		remove_variable = cr_metternichs_gambit_var
		ai_chance = {
			base = 15
		}
	}
}

cr_carlist_events.61 = { #A Hapsburg Haven - No Metternich
	type = country_event
	placement = scope:don_carlos_arrival_location

	title = cr_carlist_events.61.t
	desc = cr_carlist_events.61.desc
	flavor = cr_carlist_events.61.flavour

	gui_window = event_window_1char_tabloid

	#left_icon = scope:don_carlos_char
	right_icon = scope:don_carlos_supporting_politician

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 3
	
	trigger = {
	}

	immediate = {
		save_scope_as = don_carlos_exile_country
		if = {
			limit = {
				any_scope_state = {
					state_region = s:STATE_ISTRIA
				}
			}
			random_scope_state = {
				limit = {
					state_region = s:STATE_ISTRIA
				}
				save_scope_as = don_carlos_arrival_location
				save_scope_as = carlos_arrival_state
			}
		}
		else_if = {
			limit = {
				any_scope_state = {
					is_incorporated = yes
					is_coastal = yes
				}
			}
			save_scope_as = don_carlos_arrival_location
			save_scope_as = carlos_arrival_state	
		}
		else = {
			random_scope_state = {
				limit = {
					is_incorporated = yes
				}
				save_scope_as = don_carlos_arrival_location
				save_scope_as = carlos_arrival_state
			}
		}
		if = {
			limit = {
				any_scope_state = {
					state_region = s:STATE_EAST_GALICIA
				}
			}
			random_scope_state = {
				limit = {
					state_region = s:STATE_EAST_GALICIA
				}
				save_scope_as = don_carlos_exile_location
				save_scope_as = don_carlos_exile_state
			}
		}
		else_if = {
			limit = {
				any_scope_state = {
					state_region = s:STATE_NORTHERN_TRANSYLVANIA
				}
			}
			random_scope_state = {
				limit = {
					state_region = s:STATE_NORTHERN_TRANSYLVANIA
				}
				save_scope_as = don_carlos_exile_location
				save_scope_as = don_carlos_exile_state
			}
		}
		else_if = {
			limit = {
				any_scope_state = {
					state_region = s:STATE_MORAVIA
				}
			}
			random_scope_state = {
				limit = {
					state_region = s:STATE_MORAVIA
				}
				save_scope_as = don_carlos_exile_location
				save_scope_as = don_carlos_exile_state
			}
		}
		else = {
			random_scope_state = {
				save_scope_as = don_carlos_exile_location
				save_scope_as = don_carlos_exile_state
			}
		}
		if = {
			limit = {
				scope:don_carlos_exile_country = {
					this = c:AUS
					any_scope_character = {
						has_template = ecchi_aus_metternich_character_template
					}
				}
			}
			scope:don_carlos_exile_country = {
				random_scope_character = {
					limit = {
						has_template = ecchi_aus_metternich_character_template
					}
					save_scope_as = don_carlos_supporting_politician
				}
			}
		}
		else = {
			scope:don_carlos_exile_country = {
				ruler = {
					save_scope_as = don_carlos_supporting_politician
				}
			}
		}
	}

	option = {
		name = cr_carlist_events.61.a
		custom_tooltip = {
			text = cr_carlist_events.61.a_tt
		}
		don_carlos_normal_exile_effect = yes
		default_option = yes
		
		remove_variable = cr_metternichs_gambit_var
		ai_chance = {
			base = 60
		}
	}

	option = {
		name = cr_carlist_events.61.b
		don_carlos_tacit_support_effect = yes
		clear_saved_scope = don_carlos_exile_location
		capital = {
			save_scope_as = don_carlos_exile_location
		}
		
		remove_variable = cr_metternichs_gambit_var
		ai_chance = {
			base = 15
		}
	}

	option = {
		name = cr_carlist_events.61.c
		custom_tooltip = {
			text = cr_carlist_events.61.c_tt
		}
		
		remove_variable = cr_metternichs_gambit_var
		don_carlos_reject_asylum_effect = yes
		ai_chance = {
			base = 15
		}
	}
}

#############################
#							#
#  Carlos to Naples branch	#
#							#
#############################
cr_carlist_events.70 = { #A Kinsman in Exile
	type = country_event
	placement = scope:carlos_arrival_state

	title = cr_carlist_events.70.t
	desc = {
		first_valid = {
			triggered_desc = {
				desc = cr_carlist_events.70.desc_legitimist_absolutist_rejected
				trigger = {
					scope:don_carlos_exile_rejected = {
						exists = yes
						has_law = law_type:law_monarchy
						ruler = {
							has_ideology = ideology:ideology_orleanist
						}
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.70.desc_legitimist_absolutist_rejected
				trigger = {
					scope:don_carlos_exile_rejected = {
						exists = yes
						has_law = law_type:law_monarchy
						ruler = {
							has_ideology = ideology:ideology_legitimist
						}
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.70.desc_prev_rejected
				trigger = {
					#scope:don_carlos_exile_rejected = {
					#	exists = yes
					#}
				}
			}
			triggered_desc = {
				trigger = {
					NOT = {
						has_law = law_type:law_autocracy
					}
				}
				desc = cr_carlist_events.70.desc_non_absolutist
			}
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.70.desc
			}
		}
	}
	flavor = {
		first_valid = {
			triggered_desc = {
				desc = cr_carlist_events.70.flavour_legitimist_absolutist_rejected
				trigger = {
					scope:don_carlos_exile_rejected = {
						exists = yes
						this = c:FRA
						has_law = law_type:law_monarchy
						ruler = {
							has_ideology = ideology:ideology_orleanist
						}
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.70.flavour_legitimist_absolutist_rejected
				trigger = {
					scope:don_carlos_exile_rejected = {
						exists = yes
						has_law = law_type:law_monarchy
						ruler = {
							has_ideology = ideology:ideology_legitimist
						}
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.70.flavour_prev_rejected
				trigger = {
					#scope:don_carlos_exile_rejected = {
					#	exists = yes
					#}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.70.flavour_no_absolutist
				trigger = {
					NOT = {
						has_law = law_type:law_autocracy
					}
				}
			}
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.70.flavour
			}
		}
	}

	gui_window = event_window_1char_tabloid

	#left_icon = scope:don_carlos_char

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 3

	trigger = {
	}

	immediate = {
		save_scope_as = don_carlos_exile_country
		capital = {
			save_scope_as = don_carlos_arrival_location
			save_scope_as = carlos_arrival_state
			save_scope_as = don_carlos_exile_state
			save_scope_as = don_carlos_exile_location
		}
	}

	option = {
		name = cr_carlist_events.70.a
		custom_tooltip = cr_carlist_events.70.a_tt
		
		don_carlos_normal_exile_effect = yes
		default_option = yes
		
		ai_chance = {
			base = 40
			modifier = {
				trigger = {
					"relations(scope:spain)" >= relations_threshold:cordial
				}
				add = -10
			}
			modifier = {
				trigger = {
					"relations(scope:spain)" >= relations_threshold:amicable
				}
				add = -10
			}
			modifier = {
				trigger = {
					"relations(scope:spain)" >= relations_threshold:friendly
				}
				add = -20
			}
		}
	}

	option = {
		name = cr_carlist_events.70.b
		custom_tooltip = cr_carlist_events.70.b_tt
		
		don_carlos_support_claim_effect = yes
		
		ai_chance = {
			base = 40
			modifier = {
				trigger = {
					infamy >= infamy_threshold:infamous
				}
				add = -20
			}
			modifier = {
				trigger = {
					infamy >= infamy_threshold:notorious
				}
				add = -100
			}
			modifier = {
				trigger = {
					authority < 300
				}
				add = -20
			}
			modifier = {
				trigger = {
					authority < 200
				}
				add = -20
			}
			modifier = {
				trigger = {
					"relations(scope:spain)" >= relations_threshold:cordial
				}
				add = -10
			}
			modifier = {
				trigger = {
					"relations(scope:spain)" >= relations_threshold:amicable
				}
				add = -20
			}
			modifier = {
				trigger = {
					"relations(scope:spain)" >= relations_threshold:friendly
				}
				add = -20
			}
		}
	}

	option = {
		name = cr_carlist_events.70.c
		custom_tooltip = cr_carlist_events.70.c_tt
		don_carlos_reject_asylum_effect = yes
		ai_chance = {
			base = 20
			modifier = {
				trigger = {
					"relations(scope:spain)" >= relations_threshold:amicable
				}
				add = 10
			}
			modifier = {
				trigger = {
					"relations(scope:spain)" >= relations_threshold:friendly
				}
				add = 10
			}
		}
	}
}

cr_carlist_events.71 = { #Event Bridge
	type = country_event
	
	hidden = yes
	
	immediate = {
		if = {
			limit = {
				c:SIC = {
					NOT = {
						has_variable = cr_don_carlos_union_proposed
					}
					law = law_type:law_monarchy
				}
				OR = {
					c:CSP = {
						is_ai = yes
					}
					c:SPA = {
						is_ai = yes
					}
				
				}
			}
		
			c:SIC = {
				trigger_event = { id = cr_carlist_events.72 days = 4 }
				set_variable = cr_don_carlos_union_proposed
			}
		}
	}
}

cr_carlist_events.72 = { #A Royal Union for Peace
	type = country_event
	placement = ROOT

	title = cr_carlist_events.72.t
	desc = cr_carlist_events.72.desc
	flavor = cr_carlist_events.72.flavour

	gui_window = event_window_2char

	left_icon = scope:carlos_luis_char
	right_icon = scope:isabel_char

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 3
	
	trigger = {
	}

	immediate = {
		save_scope_as = don_carlos_marriage_proposing_country
		c:CSP = {
			ruler = {
				save_scope_as = don_carlos_char
			}
			heir = {
				save_scope_as = carlos_luis_char
			}
		}
		c:SPA = {
			ruler = {
				save_scope_as = isabel_char
			}
			save_scope_as = spain
		}
	}

	option = {
		name = cr_carlist_events.72.a
		custom_tooltip = {
			text = cr_carlist_events.72.a_tt
		}
		c:CSP = {
			trigger_event = { id = cr_carlist_events.73 }
		}
		show_as_tooltip = {
			c:SPA = {
				trigger_event = { id = cr_carlist_events.73 }
			}
		}
		add_modifier = {
			name = cr_carlos_spanish_mediation
			months = 6
		}
		default_option = yes
		ai_chance = {
			base = 60
			modifier = {
				trigger = {
					influence < 300
				}
				add = -15
			}
			modifier = {
				trigger = {
					influence < 100
				}
				add = -15
			}
			modifier = {
				trigger = {
					influence < 0
				}
				add = -25
			}
			modifier = {
				trigger = {
					influence < -150
				}
				add = -15
			}
		}
	}

	option = {
		name = cr_carlist_events.72.b
		custom_tooltip = {
			text = cr_carlist_events.72.b_tt
		}
		show_as_tooltip = {
			c:CSP = {
				trigger_event = { id = cr_carlist_events.73 }
			}
			c:SPA = {
				trigger_event = { id = cr_carlist_events.73 }
			}
		}
		hidden_effect = {
			c:CSP = {
				trigger_event = { id = cr_carlist_events.73 days = 34 }
				set_variable = cr_don_carlos_naples_reconciliation
			}
			c:SPA = {
				set_variable = cr_don_carlos_naples_reconciliation
			}
		}
		add_modifier = {
			name = cr_carlos_spanish_reconciliation
			months = 6
		}
		ai_chance = {
			base = 15
			modifier = {
				trigger = {
					influence < 800
				}
				add = -10
			}
			modifier = {
				trigger = {
					influence < 300
				}
				add = -15
			}
			modifier = {
				trigger = {
					influence < 0
				}
				add = -15
			}
		}
	}

	option = {
		name = cr_carlist_events.72.c
		custom_tooltip = {
			text = cr_carlist_events.72.c_tt
		}
		ai_chance = {
			base = 25
			modifier = {
				trigger = {
					influence < 300
				}
				add = 10
			}
			modifier = {
				trigger = {
					influence < 0
				}
				add = 10
			}
			modifier = {
				trigger = {
					influence < -150
				}
				add = 10
			}
			modifier = {
				trigger = {
					influence < -300
				}
				add = 10
			}
		}
	}
}

cr_carlist_events.73 = { #The Crown Reunited? - Carlists
	type = country_event
	placement = scope:don_carlos_marriage_proposing_country

	title = cr_carlist_events.73.t
	desc = cr_carlist_events.73.desc
	flavor = cr_carlist_events.73.flavour

	gui_window = event_window_2char

	left_icon = scope:carlos_luis_char
	right_icon = scope:isabel_char

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 3
	
	trigger = {
	}

	immediate = {
		random_scope_war = {
			save_scope_as = carlist_war
		}
		set_global_variable = cr_two_sicilies_marriage_proposal_don_carlos_var #Used for event localisation later on
	}

	option = {
		name = cr_carlist_events.73.a #Insist on Don Carlos Luis as King—The True Succession
		custom_tooltip = {
			text = cr_carlist_events.73.a_tt
		}
		default_option = yes
		custom_tooltip = cr_carlist_events.73.tt_2
		custom_tooltip = cr_carlist_events.73.tt
		show_as_tooltip = {
			scope:carlos_luis_char = {
				set_character_as_ruler  = yes
			}
			annex_with_incorporation = c:SPA
			hidden_effect = {
				scope:isabel_char = {
					transfer_character = ROOT
				}
			}
			set_heir = scope:isabel_char
		}
		hidden_effect = { #Covered by cr_carlist_events.73.tt_2 for clearity of the tooltip.
			c:SPA = {
				show_as_tooltip = { trigger_event = { id = cr_carlist_events.74 } }
				hidden_effect = { trigger_event = { id = cr_carlist_events.74 days = 14 } }
				set_variable = cr_carlist_supremacist
			}
		}
		ai_chance = {
			base = 35
			modifier = {
				trigger = {
					has_variable = cr_don_carlos_naples_reconciliation
				}
				add = -10
			}
			modifier = {
				trigger = {
					enemy_occupation > 0.4
				}
				add = -10
			}
			modifier = {
				trigger = {
					scope:carlist_war = {
						has_war_support = { target = ROOT value <= 50 }
					}
				}
				add = -10
			}
		}
	}

	option = {
		name = cr_carlist_events.73.b #Compromise on a Joint Reign—A Shared Future
		custom_tooltip = {
			text = cr_carlist_events.73.b_tt
		}
		c:SPA = { 
			hidden_effect = { trigger_event = { id = cr_carlist_events.74 days = 14 } }
			set_variable = cr_carlist_compromise
		}
		custom_tooltip = cr_carlist_events.73.tt_2
		custom_tooltip = cr_carlist_events.73.tt
		show_as_tooltip = {
			annex_with_incorporation = c:SPA
			cr_carlos_luis_compromise_effect = yes
		}
		
		ai_chance = {
			base = 5
			modifier = {
				trigger = {
					has_variable = cr_don_carlos_naples_reconciliation
				}
				add = 10
			}
			modifier = {
				trigger = {
					enemy_occupation >= 0.4
				}
				add = 10
			}
			modifier = {
				trigger = {
					scope:carlist_war = {
						has_war_support = { target = ROOT value <= 30 }
					}
				}
				add = 25
			}
		}
	}

	option = {
		name = cr_carlist_events.73.c #Accept Isabel as Queen, with Don Carlos as Regent—A Provisional Arrangement
		custom_tooltip = {
			text = cr_carlist_events.73.c_tt
		}
		c:SPA = { 
			hidden_effect = { trigger_event = { id = cr_carlist_events.74 days = 14 } }
			set_variable = cr_carlist_regent
		}
		custom_tooltip = cr_carlist_events.73.tt_2
		custom_tooltip = cr_carlist_events.73.tt
		show_as_tooltip = {
			annex_with_incorporation = c:SPA
			change_tag = SPA
			cr_don_carlos_becomes_regent_effect = yes
		}
		
		ai_chance = {
			base = 10
			modifier = {
				trigger = {
					has_variable = cr_don_carlos_naples_reconciliation
				}
				add = 15
			}
			modifier = {
				trigger = {
					enemy_occupation >= 0.4
				}
				add = 5
			}
			modifier = {
				trigger = {
					scope:carlist_war = {
						has_war_support = { target = ROOT value <= 50 }
					}
				}
				add = 15
			}
		}
	}

	option = {
		name = cr_carlist_events.73.d #Reject the Proposal Outright—No Compromise with Usurpation
		custom_tooltip = {
			text = cr_carlist_events.73.d_tt
		}
		save_scope_as = event_location
		
		scope:don_carlos_marriage_proposing_country = {
			hidden_effect = { trigger_event = { id = cr_carlist_events.79 days = 28 } }
			set_variable = cr_don_carlos_marriage_proposal_reject_csp
		}
		show_as_tooltip = {
			scope:don_carlos_marriage_proposing_country = {
				trigger_event = { id = cr_carlist_events.79 }
			}
			change_relations = {
				country = c:SIC
				value = -25
			}
		}
		
		remove_global_variable = cr_two_sicilies_marriage_proposal_don_carlos_var
		
		ai_chance = {
			base = 50
			modifier = {
				trigger = {
					has_variable = cr_don_carlos_naples_reconciliation
				}
				add = -25
			}
			modifier = {
				trigger = {
					enemy_occupation >= 0.4
				}
				add = -15
			}
			modifier = {
				trigger = {
					scope:carlist_war = {
						has_war_support = { target = ROOT value <= 60 }
					}
				}
				add = -15
			}
		}
	}
}

cr_carlist_events.74 = { #The Crown Reunited? - Isabel response event
	type = country_event
	placement = scope:don_carlos_marriage_proposing_country
	title = {
		first_valid = {
			#Don Carlos wants to compromise
			triggered_desc = {
				trigger = {
					has_variable = cr_carlist_compromise
				}
				desc = cr_carlist_events.73.t
			}
			#Don Carlos proposes himself as regent
			triggered_desc = {
				trigger = {
					has_variable = cr_carlist_regent
				}
				desc = cr_carlist_events.74.t_carlos_regent
			}
			#Fallback
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.73.t
			}
		}
	}
	desc = {
		first_valid = {
			#Don Carlos wants Carlos Luis as king
			triggered_desc = {
				trigger = {
					has_variable = cr_carlist_supremacist
				}
				desc = cr_carlist_events.74.desc_carlos_supremacist
			}
			#Don Carlos wants to compromise
			triggered_desc = {
				trigger = {
					has_variable = cr_carlist_compromise
				}
				desc = cr_carlist_events.74.desc_compromise
			}
			#Don Carlos proposes himself as regent
			triggered_desc = {
				trigger = {
					has_variable = cr_carlist_regent
				}
				desc = cr_carlist_events.74.desc_carlos_regent
			}
			
			#fallback
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.74.fallback
			}
		}
	}
	
	flavor = { 
		first_valid = {
			#Don Carlos wants Carlos Luis as king
			triggered_desc = {
				trigger = {
					has_variable = cr_carlist_supremacist
				}
				desc = cr_carlist_events.74.flavour_carlos_supremacist
			}
			#Don Carlos wants to compromise
			triggered_desc = {
				trigger = {
					has_variable = cr_carlist_compromise
				}
				desc = cr_carlist_events.74.flavour_compromise
			}
			#Don Carlos proposes himself as regent
			triggered_desc = {
				trigger = {
					has_variable = cr_carlist_regent
				}
				desc = cr_carlist_events.74.flavour_carlos_regent
			}
			
			#fallback
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.74.flavour_fallback
			}
		}
	}

	gui_window = event_window_2char

	left_icon = scope:carlos_luis_char
	right_icon = scope:isabel_char

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 3
	
	trigger = {
	}

	immediate = {
		if = {
			limit = {
				NOT = {
					has_variable = cr_don_carlos_marriage_proposal_reject_csp
				}
			}
			save_scope_as = event_location
		}
		ig:ig_intelligentsia = {
			leader = {
				save_scope_as = mendizabal
			}
		}
	}

	###Carlos Luis as king

	option = { #Reject Carlos Luis as king
		trigger = {
			has_variable = cr_carlist_supremacist
		}
		
		name = cr_carlist_events.74.a_carlist_supremacy
		custom_tooltip = {
			text = cr_carlist_events.74.a_carlist_supremacy_tt
		}
		
		c:CSP = {
			set_variable = cr_isabel_rejects_don_carlos_luis_king
			show_as_tooltip = { trigger_event = { id = cr_carlist_events.75 } }
			hidden_effect = { trigger_event = { id = cr_carlist_events.75 days = 7 } }
		}
		show_as_tooltip = {
			change_relations = {
				country = c:SIC
				value = -10
			}
		}
		c:SIC = { set_variable = cr_isabel_rejects_don_carlos_luis_king }
		
		default_option = yes
		ai_chance = {
			base = 90
			modifier = {
				trigger = {
					has_variable = cr_don_carlos_naples_reconciliation
				}
				add = -30
			}
			modifier = {
				trigger = {
					enemy_occupation >= 0.2
				}
				add = -20
			}
			modifier = {
				trigger = {
					scope:carlist_war = {
						has_war_support = { target = ROOT value <= 50 }
					}
				}
				add = -20
			}
		}
	}

	option = { #Accept Carlos Luis as king
		trigger = {
			has_variable = cr_carlist_supremacist
			OR = {	#To prevent a CTD!!!!
				c:CSP = {
					is_player = no
				}
				c:SPA = {
					is_player = no
				}
			}
		}
		name = cr_carlist_events.74.b_carlist_supremacy
		custom_tooltip = {
			text = cr_carlist_events.74.b_carlist_supremacy_tt
		}
		
		if = {
			limit = {
				c:CSP = {
					is_player = yes
				}
			}
			custom_tooltip = cr_carlist_events.74.lose_tt
			c:CSP = { 
				set_variable = cr_isabel_accepts_don_carlos_luis_king
				show_as_tooltip = { trigger_event = { id = cr_carlist_events.75 } }
				hidden_effect = { trigger_event = { id = cr_carlist_events.75 days = 7 } }
			}
			show_as_tooltip = {
				c:CSP = {
					annex_with_incorporation = c:SPA
				}
				cr_carlos_luis_becomes_king_effect = yes
			}
		}
		else_if = {
			limit = {
				c:CSP = {
					is_player = no
				}
			}
			annex_with_incorporation = c:CSP
			cr_carlos_luis_becomes_king_effect = yes
			show_as_tooltip = { change_tag = CSP }
			cr_don_carlos_mediation_trigger_sicilian_event_effect = yes
		}
		
		c:SIC = { set_variable = cr_isabel_accepts_don_carlos_luis_king }
		
		ai_chance = {
			base = 10
			modifier = {
				trigger = {
					has_variable = cr_don_carlos_naples_reconciliation
				}
				add = 20
			}
			modifier = {
				trigger = {
					enemy_occupation >= 0.2
				}
				add = 15
			}
			modifier = {
				trigger = {
					scope:carlist_war = {
						has_war_support = { target = ROOT value <= 30 }
					}
				}
				add = 25
			}
		}
	}

	###Equal marriage between Isabel and Carlos Luis

	option = { #Accept the Carlist compromise
		trigger = {
			has_variable = cr_carlist_compromise
			OR = {	#To prevent a CTD!!!!
				c:CSP = {
					is_player = no
				}
				c:SPA = {
					is_player = no
				}
			}
		}
		name = cr_carlist_events.74.a_carlist_compromise
		custom_tooltip = {
			text = cr_carlist_events.74.a_carlist_compromise_tt
		}
		
		if = {
			limit = {
				c:CSP = {
					is_player = yes
				}
			}
			custom_tooltip = cr_carlist_events.74.lose_tt
			c:CSP = { 
				set_variable = cr_isabel_accept_compromise
				show_as_tooltip = { trigger_event = { id = cr_carlist_events.75 } }
				hidden_effect = { trigger_event = { id = cr_carlist_events.75 days = 7 } }
			}
			show_as_tooltip = {
				c:CSP = {
					annex_with_incorporation = c:SPA
				}
				cr_carlos_luis_compromise_effect = yes
				set_heir = scope:carlos_luis_char
			}
		}
		else_if = {
			limit = {
				c:CSP = {
					is_player = no
				}
			}
			cr_carlos_luis_compromise_effect = yes
			annex_with_incorporation = c:CSP
			cr_don_carlos_mediation_trigger_sicilian_event_effect = yes
		}
		
		c:SIC = { set_variable = cr_isabel_accept_compromise }
		
		ai_chance = {
			base = 35
			modifier = {
				trigger = {
					has_variable = cr_don_carlos_naples_reconciliation
				}
				add = 20
			}
			modifier = {
				trigger = {
					enemy_occupation >= 0.2
				}
				add = 15
			}
			modifier = {
				trigger = {
					scope:carlist_war = {
						has_war_support = { target = ROOT value <= 60 }
					}
				}
				add = 15
			}
		}
	}
	option = { #Reject the Carlist compromise
		trigger = {
			has_variable = cr_carlist_compromise
		}
		
		name = cr_carlist_events.74.b_carlist_compromise
		custom_tooltip = {
			text = cr_carlist_events.74.b_carlist_compromise_tt
		}
		
		c:CSP = {
			set_variable = cr_isabel_rejects_compromise
			show_as_tooltip = { trigger_event = { id = cr_carlist_events.75 } }
			hidden_effect = { trigger_event = { id = cr_carlist_events.75 days = 7 } }
		}
		show_as_tooltip = {
			change_relations = {
				country = c:SIC
				value = -20
			}
		}
		c:SIC = { set_variable = cr_isabel_rejects_compromise }
		
		default_option = yes
		ai_chance = {
			base = 60
			modifier = {
				trigger = {
					has_variable = cr_don_carlos_naples_reconciliation
				}
				add = -25
			}
			modifier = {
				trigger = {
					enemy_occupation >= 0.2
				}
				add = -20
			}
			modifier = {
				trigger = {
					scope:carlist_war = {
						has_war_support = { target = ROOT value <= 30 }
					}
				}
				add = -20
			}
		}
	}
	
	###Don Carlos as regent
	
	#Accept Carlos as regent
	option = { 
		trigger = {
			has_variable = cr_carlist_regent
			OR = {	#To prevent a CTD!!!!
				c:CSP = {
					is_player = no
				}
				c:SPA = {
					is_player = no
				}
			}
		}
		name = cr_carlist_events.74.a_carlos_regent
		custom_tooltip = {
			text = cr_carlist_events.74.a_carlos_regent_tt
		}
		
		if = {
			limit = {
				c:CSP = {
					is_player = yes
				}
			}
			custom_tooltip = cr_carlist_events.74.lose_tt
			c:CSP = { 
				set_variable = cr_isabel_accepts_regent
				show_as_tooltip = { trigger_event = { id = cr_carlist_events.75 } }
				hidden_effect = { trigger_event = { id = cr_carlist_events.75 days = 7 } }
			}
			show_as_tooltip = {
				c:CSP = {
					annex_with_incorporation = c:SPA
				}
				cr_don_carlos_becomes_regent_effect = yes
			}
		}
		else_if = {
			limit = {
				c:CSP = {
					is_player = no
				}
			}
			cr_don_carlos_becomes_regent_effect = yes
			annex_with_incorporation = c:CSP
			cr_don_carlos_mediation_trigger_sicilian_event_effect = yes
		}
		
		c:SIC = { set_variable = cr_isabel_accepts_regent }
		
		ai_chance = {
			base = 65
			modifier = {
				trigger = {
					has_variable = cr_don_carlos_naples_reconciliation
				}
				add = -30
			}
			modifier = {
				trigger = {
					enemy_occupation >= 0.2
				}
				add = -15
			}
			modifier = {
				trigger = {
					scope:carlist_war = {
						has_war_support = { target = ROOT value <= 30 }
					}
				}
				add = -20
			}
		}
	}
	
	#Reject the Carlos as regent
	option = { 
		trigger = {
			has_variable = cr_carlist_regent
		}
		
		name = cr_carlist_events.74.b_carlos_regent
		custom_tooltip = {
			text = cr_carlist_events.74.b_carlos_regent_tt
		}
		
		c:CSP = {
			set_variable = cr_isabel_rejects_regent
			show_as_tooltip = { trigger_event = { id = cr_carlist_events.75 } }
			hidden_effect = { trigger_event = { id = cr_carlist_events.75 days = 7 } }
		}
		show_as_tooltip = {
			change_relations = {
				country = c:SIC
				value = -10
			}
		}
		c:SIC = { set_variable = cr_isabel_rejects_regent }
		
		default_option = yes
		ai_chance = {
			base = 70
			modifier = {
				trigger = {
					has_variable = cr_don_carlos_naples_reconciliation
				}
				add = -30
			}
			modifier = {
				trigger = {
					enemy_occupation >= 0.2
				}
				add = -20
			}
			modifier = {
				trigger = {
					scope:carlist_war = {
						has_war_support = { target = ROOT value <= 40 }
					}
				}
				add = -20
			}
		}
	}



	#Fallback
	option = {
		trigger = {
			NOT = {
				has_variable = cr_carlist_supremacist
				has_variable = cr_carlist_compromise
				has_variable = cr_carlist_regent
			}
		}
		name = cr_carlist_events.74.c_carlist_supremacy
		custom_tooltip = {
			text = cr_carlist_events.74.c_carlist_supremacy_tt
		}
		default_option = yes
	}
}

cr_carlist_events.75 = { #The Crown Reunited? - Response to Isabel's response
	type = country_event
	placement = scope:spain
	title = {
		first_valid = {
			#Isabel accepts Don Carlos Luis as king
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accepts_don_carlos_luis_king
				}
				desc = cr_carlist_events.75.t_accepted_carlos_luis_as_king
			}
			#Isabel accepts the compromise
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accept_compromise
				}
				desc = cr_carlist_events.75.t_accepted_carlos_luis_as_king
			}
			#Isabel rejects the compromise
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_compromise
				}
				desc = cr_carlist_events.75.t_joint_reign_rejected
			}
			#Isabel rejects Carlos as regent
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_regent
				}
				desc = cr_carlist_events.75.t_regency_rejected
			}
			##Isabel accepts Carlos as regent
			#triggered_desc = {
			#	trigger = {
			#		has_variable = cr_isabel_accepts_regent
			#	}
			#	desc = cr_carlist_events.75.t_regency_accepted
			#}
			#Fallback
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.73.t
			}
		}
	}
	desc = {
		first_valid = {
			#Isabel rejects Don Carlos Luis as king
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_don_carlos_luis_king
				}
				desc = cr_carlist_events.75.desc_rejected_carlos_luis_as_king
			}
			#Isabel accepts Don Carlos Luis as king
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accepts_don_carlos_luis_king
				}
				desc = cr_carlist_events.75.desc_accepted_carlos_luis_as_king
			}
			#Isabel accepts the compromise
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accept_compromise
				}
				desc = cr_carlist_events.75.desc_joint_reign_accepted
			}
			#Isabel rejects the compromise
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_compromise
				}
				desc = cr_carlist_events.75.desc_joint_reign_rejected
			}
			#Isabel rejects Carlos as regent
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_regent
				}
				desc = cr_carlist_events.75.desc_regency_rejected
			}
			#Isabel accepts Carlos as regent
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accepts_regent
				}
				desc = cr_carlist_events.75.desc_regency_accepted
			}
			
			#fallback
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.75.fallback
			}
		}
	}
	
	flavor = { 
		first_valid = {
			#Isabel rejects Don Carlos Luis as king
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_don_carlos_luis_king
				}
				desc = cr_carlist_events.75.flavour_rejected_carlos_luis_as_king
			}
			#Isabel accepts Don Carlos Luis as king
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accepts_don_carlos_luis_king
				}
				desc = cr_carlist_events.75.flavour_accepted_carlos_luis_as_king
			}
			#Isabel accepts the compromise
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accept_compromise
				}
				desc = cr_carlist_events.75.flavour_joint_reign_accepted
			}
			#Isabel rejects the compromise
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_compromise
				}
				desc = cr_carlist_events.75.flavour_joint_reign_rejected
			}
			#Isabel rejects Carlos as regent
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_regent
				}
				desc = cr_carlist_events.75.flavour_regency_rejected
			}
			#Isabel accepts Carlos as regent
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accepts_regent
				}
				desc = cr_carlist_events.75.flavour_regency_accepted
			}
			
			#fallback
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.75.flavour_fallback
			}
		}
	}

	gui_window = event_window_2char

	left_icon = scope:carlos_luis_char
	right_icon = scope:isabel_char

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 3
	
	trigger = {
	}

	immediate = {
		if = {
			limit = {
				NOT = {
					has_variable = cr_don_carlos_marriage_proposal_reject_csp
					has_variable = cr_isabel_rejects_don_carlos_luis_king
				}
			}
			save_scope_as = event_location
		}
	}

	###Carlos Luis as king

	option = {	#Carlos Luis rejected as king
		trigger = {
			has_variable = cr_isabel_rejects_don_carlos_luis_king
		}
		
		name = cr_carlist_events.75.a_rejected_carlos_luis_as_king
		custom_tooltip = {
			text = cr_carlist_events.75.a_rejected_carlos_luis_as_king_tt
		}
		cr_don_carlos_mediation_trigger_sicilian_event_effect = yes
		
		show_as_tooltip = {
			change_relations = {
				country = c:SIC
				value = -10
			}
		}
		
		default_option = yes
	}

	option = {	#Carlos Luis accepted as king
		trigger = {
			has_variable = cr_isabel_accepts_don_carlos_luis_king
		}
		
		name = cr_carlist_events.75.a_accepted_carlos_luis_as_king
		custom_tooltip = {
			text = cr_carlist_events.75.a_accepted_carlos_luis_as_king_tt
		}
		annex_with_incorporation = c:SPA
		cr_carlos_luis_becomes_king_effect = yes
		cr_don_carlos_mediation_trigger_sicilian_event_effect = yes
		
		default_option = yes
	}

	###Isabel and Carlos Luis compromise

	option = {	#Isabel accepts the compromise
		trigger = {
			has_variable = cr_isabel_accept_compromise
		}
		
		name = cr_carlist_events.75.a_joint_reign_accepted
		custom_tooltip = {
			text = cr_carlist_events.75.a_joint_reign_accepted_tt
		}
		annex_with_incorporation = c:SPA
		cr_carlos_luis_compromise_effect = yes
		cr_don_carlos_mediation_trigger_sicilian_event_effect = yes
		
		default_option = yes
	}

	option = {	#Isabel accepts the compromise
		trigger = {
			has_variable = cr_isabel_rejects_compromise
		}
		
		name = cr_carlist_events.75.a_joint_reign_rejected
		custom_tooltip = {
			text = cr_carlist_events.75.a_joint_reign_rejected_tt
		}
		cr_don_carlos_mediation_trigger_sicilian_event_effect = yes
		
		default_option = yes
	}
	
	###Don Carlos as regent

	option = {	#Isabel accepts Don Carlos as regent
		trigger = {
			has_variable = cr_isabel_accepts_regent
		}
		
		name = cr_carlist_events.75.a_regency_accepted
		custom_tooltip = {
			text = cr_carlist_events.75.a_regency_accepted_tt
		}
		annex_with_incorporation = c:SPA
		cr_don_carlos_becomes_regent_effect = yes
		cr_don_carlos_mediation_trigger_sicilian_event_effect = yes
		
		default_option = yes
	}

	option = {	#Isabel rejects Don Carlos as regent
		trigger = {
			has_variable = cr_isabel_rejects_regent
		}
		
		name = cr_carlist_events.75.a_regency_rejected
		custom_tooltip = {
			text = cr_carlist_events.75.a_regency_rejected_tt
		}
		cr_don_carlos_mediation_trigger_sicilian_event_effect = yes
		
		default_option = yes
	}


	#Fallback
	option = {
		trigger = {
			NOT = {
				has_variable = cr_isabel_rejects_don_carlos_luis_king
				has_variable = cr_isabel_accepts_don_carlos_luis_king
				has_variable = cr_isabel_accept_compromise
				has_variable = cr_isabel_rejects_compromise
				has_variable = cr_isabel_rejects_regent
				has_variable = cr_isabel_accepts_regent
			}
		}
		name = cr_carlist_events.74.c_carlist_supremacy
		custom_tooltip = {
			text = cr_carlist_events.74.c_carlist_supremacy_tt
		}
		default_option = yes
		
		
		remove_variable = cr_don_carlos_marriage_proposal_reject_csp
		remove_variable = cr_don_carlos_naples_reconciliation
		
		
		
		ai_chance = {
			base = 30
		}
	}
}


cr_carlist_events.79 = { #Two Sicilies Response event
	type = country_event
	placement = scope:event_location
	title = {
		first_valid = {
			#Don Carlos outright rejection
			triggered_desc = {
				trigger = {
					has_variable = cr_don_carlos_marriage_proposal_reject_csp
				}
				desc = cr_carlist_events.79.t_carlos_rejects
			}
			#Carlos Luis rejected as king
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_don_carlos_luis_king
				}
				desc = cr_carlist_events.79.t_isabel_rejected_carlos_luis_as_king
			}
			#Carlos Luis accepted as king
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accepts_don_carlos_luis_king
				}
				desc = cr_carlist_events.79.t_isabel_accepted_carlos_luis_as_king
			}
			#Spain accepts the compromise solution
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accept_compromise
				}
				desc = cr_carlist_events.79.t_joint_reign
			}
			#Spain rejects the compromise solution
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_compromise
				}
				desc = cr_carlist_events.79.t_joint_reign_rejected
			}
			#Spain rejects Carlos as regent
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_regent
				}
				desc = cr_carlist_events.79.t_regency_rejected
			}
			#Spain accepts Carlos as regent
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accepts_regent
				}
				desc = cr_carlist_events.79.t_regency_accepted
			}
			#Fallback
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.79.t_fallback
			}
		}
	}
	desc = {
		first_valid = {
			#Don Carlos outright rejection
			triggered_desc = {
				trigger = {
					has_variable = cr_don_carlos_marriage_proposal_reject_csp
				}
				desc = cr_carlist_events.79.desc_carlos_rejects
			}
			#Carlos Luis rejected as king
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_don_carlos_luis_king
				}
				desc = cr_carlist_events.79.desc_isabel_rejected_carlos_luis_as_king
			}
			#Carlos Luis accepted as king
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accepts_don_carlos_luis_king
				}
				desc = cr_carlist_events.79.desc_isabel_accepted_carlos_luis_as_king
			}
			#Spain accepts the compromise solution
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accept_compromise
				}
				desc = cr_carlist_events.79.desc_joint_reign
			}
			#Spain rejects the compromise solution
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_compromise
				}
				desc = cr_carlist_events.79.desc_joint_reign_rejected
			}
			#Spain rejects Carlos as regent
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_regent
				}
				desc = cr_carlist_events.79.desc_regency_rejected
			}
			#Spain accepts Carlos as regent
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accepts_regent
				}
				desc = cr_carlist_events.79.desc_regency_accepted
			}
			
			#fallback
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.79.fallback
			}
		}
	}
	
	flavor = { 
		first_valid = {
			#Don Carlos outright rejection
			triggered_desc = {
				trigger = {
					has_variable = cr_don_carlos_marriage_proposal_reject_csp
				}
				desc = cr_carlist_events.79.flavour_carlos_rejects
			}
			#Carlos Luis rejected as king
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_don_carlos_luis_king
				}
				desc = cr_carlist_events.79.flavour_isabel_rejected_carlos_luis_as_king
			}
			#Carlos Luis accepted as king
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accepts_don_carlos_luis_king
				}
				desc = cr_carlist_events.79.flavour_isabel_accepted_carlos_luis_as_king
			}
			#Spain accepts the compromise solution
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accept_compromise
				}
				desc = cr_carlist_events.79.flavour_joint_reign
			}
			#Spain rejects the compromise solution
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_compromise
				}
				desc = cr_carlist_events.79.flavour_joint_reign_rejected
			}
			#Spain rejects Carlos as regent
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_rejects_regent
				}
				desc = cr_carlist_events.79.flavour_regency_rejected
			}
			#Spain accepts Carlos as regent
			triggered_desc = {
				trigger = {
					has_variable = cr_isabel_accepts_regent
				}
				desc = cr_carlist_events.79.flavour_regency_accepted
			}
			
			#fallback
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.79.flavour_fallback
			}
		}
	}

	gui_window = event_window_2char

	left_icon = scope:carlos_luis_char
	right_icon = scope:isabel_char

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 3
	
	trigger = {
	}
	
	cancellation_trigger = {
		has_variable = cr_sicilian_mediation_has_ended
	}

	immediate = {
		if = {
			limit = {
				NOT = {
					has_variable = cr_don_carlos_marriage_proposal_reject_csp
					has_variable = cr_isabel_rejects_don_carlos_luis_king
					has_variable = cr_isabel_accepts_don_carlos_luis_king
				}
			}
			save_scope_as = event_location
		}
		if = {
			limit = {
				exists = c:SPA 
				NOT = { exists = c:CSP }
			}
			c:SPA = {
				save_scope_as = carlist_war_winner
			}
		}
		else_if = {
			limit = {
				NOT = { exists = c:SPA  }
				exists = c:CSP
			}
			c:SPA = {
				save_scope_as = carlist_war_winner
			}
		}
	}

	option = { #Carlos Luis rejected as king
		name = cr_carlist_events.79.isabel_rejected_carlos_luis_as_king
		trigger = {
			has_variable = cr_isabel_rejects_don_carlos_luis_king
		}
		custom_tooltip = {
			text = cr_carlist_events.79.isabel_rejected_carlos_luis_as_king_tt
		}
		default_option = yes
		cr_don_carlos_sicilian_mediation_failure_effect = yes
	}

	option = { #Carlos Luis accepted as king
		name = cr_carlist_events.79.isabel_accepted_carlos_luis_as_king
		trigger = {
			has_variable = cr_isabel_accepts_don_carlos_luis_king
		}
		custom_tooltip = {
			text = cr_carlist_events.79.isabel_accepted_carlos_luis_as_king_tt
		}
		default_option = yes
		cr_don_carlos_sicilian_mediation_succesful_effect = yes
	}

	option = { #Spain accepts the compromise solution
		name = cr_carlist_events.79.a_joint_reign
		trigger = {
			has_variable = cr_isabel_accept_compromise
		}
		custom_tooltip = {
			text = cr_carlist_events.79.a_joint_reign_tt
		}
		default_option = yes
		cr_don_carlos_sicilian_mediation_succesful_effect = yes
	}

	option = { #Spain rejects the compromise solution
		name = cr_carlist_events.79.a_joint_reign_rejected
		trigger = {
			has_variable = cr_isabel_rejects_compromise
		}
		custom_tooltip = {
			text = cr_carlist_events.79.a_joint_reign_rejected_tt
		}
		default_option = yes
		cr_don_carlos_sicilian_mediation_failure_effect = yes
	}

	option = { #Carlos rejects mediation
		name = cr_carlist_events.79.carlos_rejects_opt
		trigger = {
			has_variable = cr_don_carlos_marriage_proposal_reject_csp
		}
		custom_tooltip = {
			text = cr_carlist_events.79.carlos_rejects_opt_tt
		}
		default_option = yes
		add_modifier = {
			name = cr_carlos_failed_diplomacy
			months = normal_modifier_time
		}
		
		cr_don_carlos_two_sicilies_marriage_proposal_cleanup_effect = yes
		
		ai_chance = {
			base = 70
		}
	}

	###Carlos as regent

	option = { #Isabel rejects Carlos as regent
		name = cr_carlist_events.79.a_regency_rejected
		trigger = {
			has_variable = cr_isabel_rejects_regent
		}
		custom_tooltip = {
			text = cr_carlist_events.79.a_regency_rejected_tt
		}
		default_option = yes
		cr_don_carlos_sicilian_mediation_failure_effect = yes
		
		cr_don_carlos_two_sicilies_marriage_proposal_cleanup_effect = yes
		
		ai_chance = {
			base = 70
		}
	}

	option = { #Spain accepts Carlos as regent
		name = cr_carlist_events.79.a_regency_accepted
		trigger = {
			has_variable = cr_isabel_accepts_regent
		}
		custom_tooltip = {
			text = cr_carlist_events.79.a_regency_accepted_tt
		}
		default_option = yes
		cr_don_carlos_sicilian_mediation_succesful_effect = yes
	}

	#Fallback
	option = {
		trigger = {
			NOT = {
				has_variable = cr_don_carlos_marriage_proposal_reject_csp
				has_variable = cr_isabel_rejects_don_carlos_luis_king
				has_variable = cr_isabel_accepts_don_carlos_luis_king
				has_variable = cr_isabel_rejects_compromise
				has_variable = cr_isabel_accept_compromise
				has_variable = cr_isabel_rejects_regent
				has_variable = cr_isabel_accepts_regent
			}
		}
		name = cr_carlist_events.79.b_carlos_rejects
		custom_tooltip = {
			text = cr_carlist_events.79.b_carlos_rejects_tt
		}
		default_option = yes
		
		
		remove_variable = cr_don_carlos_marriage_proposal_reject_csp
		remove_variable = cr_don_carlos_naples_reconciliation
		
		
		
		ai_chance = {
			base = 30
		}
	}
}

#############################
#							#
# Carlos to Portugal branch	#
#							#
#############################
cr_carlist_events.80 = { #The Cause of Absolutism
	type = country_event
	placement = scope:carlos_arrival_state

	title = cr_carlist_events.80.t
	desc = {
		first_valid = {
			triggered_desc = {
				desc = cr_carlist_events.80.desc_bourbon_rejected
				trigger = {
					scope:don_carlos_exile_rejected = {
						exists = yes
						has_law = law_type:law_monarchy
						OR = {
							ruler = {
								OR = {
									has_ideology = ideology:ideology_orleanist
									has_ideology = ideology:ideology_legitimist
								}
							}
							this ?= c:SIC
						}
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.80.desc_absolutist_rejected
				trigger = {
					scope:don_carlos_exile_rejected = {
						exists = yes
						has_law = law_type:law_autocracy
					}
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.80.desc_generic_rejected
				trigger = {
					scope:don_carlos_exile_rejected = {
						exists = yes
					}
				}
			}
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = cr_carlist_events.80.desc
			}
		}
	}
	flavor = cr_carlist_events.80.flavour

	gui_window = event_window_1char_tabloid

	#left_icon = scope:don_carlos_char

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 3

	trigger = {
	}

	immediate = {
		save_scope_as = don_carlos_exile_country
		capital = {
			save_scope_as = don_carlos_arrival_location
			save_scope_as = carlos_arrival_state
			save_scope_as = don_carlos_exile_state
		}
		###Portugese Liberal movement.
		random_political_movement = {
			limit = {
				is_political_movement_type = movement_liberal
			}
			save_scope_as = liberal_movement
		}
		if = {
			limit = {
				capital = { state_region = s:STATE_ESTREMADURA}
			}
			p:xA0F6EC = { save_scope_as = don_carlos_exile_location }
		}
		else = {
			capital = { save_scope_as = don_carlos_exile_location }
		}
	}

	option = {
		name = cr_carlist_events.80.a
		don_carlos_support_claim_effect = yes
		
		ai_chance = {
			base = 40
			modifier = {
				trigger = {
					infamy >= infamy_threshold:infamous
				}
				add = -20
			}
			modifier = {
				trigger = {
					infamy >= infamy_threshold:notorious
				}
				add = -100
			}
			modifier = {
				trigger = {
					authority < 300
				}
				add = -20
			}
			modifier = {
				trigger = {
					authority < 200
				}
				add = -20
			}
			modifier = {
				trigger = {
					"relations(scope:spain)" >= relations_threshold:cordial
				}
				add = -10
			}
			modifier = {
				trigger = {
					"relations(scope:spain)" >= relations_threshold:amicable
				}
				add = -20
			}
			modifier = {
				trigger = {
					"relations(scope:spain)" >= relations_threshold:friendly
				}
				add = -20
			}
		}
	}

	option = {
		name = cr_carlist_events.80.b
		don_carlos_tacit_support_effect = yes
		default_option = yes
		
		ai_chance = {
			base = 40
			modifier = {
				trigger = {
					"relations(scope:spain)" >= relations_threshold:cordial
				}
				add = -10
			}
			modifier = {
				trigger = {
					"relations(scope:spain)" >= relations_threshold:amicable
				}
				add = -10
			}
			modifier = {
				trigger = {
					"relations(scope:spain)" >= relations_threshold:friendly
				}
				add = -20
			}
		}
	}

	option = {
		name = cr_carlist_events.80.c
		don_carlos_reject_asylum_effect = yes
		ai_chance = {
			base = 20
			modifier = {
				trigger = {
					"relations(scope:spain)" >= relations_threshold:amicable
				}
				add = 10
			}
			modifier = {
				trigger = {
					"relations(scope:spain)" >= relations_threshold:friendly
				}
				add = 10
			}
		}
	}
}

#############################
#							#
#	 Carlos to US branch	#
#							#
#############################


cr_carlist_events.90 = { #The Spanish Pretender / The King without a Country - USA #Fallback / End of chain
	type = country_event
	placement = scope:don_carlos_arrival_location

	title = cr_carlist_events.90.t
	desc = {
		first_valid = {
			triggered_desc = {
				desc = cr_carlist_events.90.desc
				trigger = {
					has_law = law_type:law_presidential_republic
					country_has_voting_franchise = yes
				}
			}
			triggered_desc = {
				desc = cr_carlist_events.90.desc_no_republic
				trigger = {
					always = yes
				}
			}
		}
	}
	flavor = cr_carlist_events.90.flavour

	gui_window = event_window_1char_tabloid

	#left_icon = scope:don_carlos_char

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 3

	trigger = {
	}

	immediate = {
		save_scope_as = don_carlos_exile_country
		random_scope_state = {
			limit = {
				OR = {
					state_region = s:STATE_VIRGINIA
					state_region = s:STATE_NORTH_CAROLINA
					state_region = s:STATE_SOUTH_CAROLINA
					state_region = s:STATE_GEORGIA
					state_region = s:STATE_MARYLAND
					state_region = s:STATE_NEW_YORK
					state_region = s:STATE_MASSACHUSETTS
				}
			}
			save_scope_as = carlos_arrival_state
			save_scope_as = don_carlos_exile_location
			save_scope_as = don_carlos_exile_state
		}
		if = {
			limit = {
				scope:carlos_arrival_state = { state_region = s:STATE_VIRGINIA }
			}
			p:x40B0C0 = {
				save_scope_as = don_carlos_arrival_location
			}
		}
		else_if = {
			limit = {
				scope:carlos_arrival_state = { state_region = s:STATE_NORTH_CAROLINA }
			}
			p:x00F040 = {
				save_scope_as = don_carlos_arrival_location
			}
		}
		else_if = {
			limit = {
				scope:carlos_arrival_state = { state_region = s:STATE_SOUTH_CAROLINA }
			}
			p:xAF8C38 = {
				save_scope_as = don_carlos_arrival_location
			}
		}
		else_if = {
			limit = {
				scope:carlos_arrival_state = { state_region = s:STATE_GEORGIA }
			}
			p:x13B302 = {
				save_scope_as = don_carlos_arrival_location
			}
		}
		else_if = {
			limit = {
				scope:carlos_arrival_state = { state_region = s:STATE_MARYLAND }
			}
			p:x3CC08F = {
				save_scope_as = don_carlos_arrival_location
			}
		}
		else_if = {
			limit = {
				scope:carlos_arrival_state = { state_region = s:STATE_NEW_YORK }
			}
			p:x644426 = {
				save_scope_as = don_carlos_arrival_location
			}
		}
		else_if = {
			limit = {
				scope:carlos_arrival_state = { state_region = s:STATE_MASSACHUSETTS }
			}
			p:x13444D = {
				save_scope_as = don_carlos_arrival_location
			}
		}
		else = {
			s:random_scope_state = {
				save_scope_as = carlos_arrival_state
				save_scope_as = don_carlos_exile_location
				save_scope_as = don_carlos_arrival_location
				save_scope_as = don_carlos_exile_state
			}
		}
	}

	option = {
		name = cr_carlist_events.90.a
		custom_tooltip = cr_carlist_events.90.a_tt
		show_as_tooltip = {
			scope:don_carlos_exile_state = {
				add_modifier = {
					name = cr_carlos_exiled_state	
					months = 180
				}
			}
		}
		don_carlos_distant_exile_effect = yes
		
		default_option = yes
		
		ai_chance = {
			base = 95
		}
	}

	option = {
		name = cr_carlist_events.90.b
		custom_tooltip = cr_carlist_events.90.b_tt
		add_modifier = {
			name = cr_beacon_of_liberty	
			months = 120
		}
		don_carlos_distant_exile_effect = yes
		every_country = {
			limit = {
				country_is_in_europe = yes
				has_law = law_type:law_monarchy
				has_law = law_type:law_autocracy
				country_rank >= rank_value:major_power
			}
			change_relations = {
				country = ROOT
				value = -10
			}
		}		
		ai_chance = {
			base = 5
		}
	}
}